{% extends "polls/common.html" %}
{% load static %}

		{% block extra_css %}
			<link rel="stylesheet" type="text/css" href="{% static 'login/css/profile.css' %}" />
			<link rel="stylesheet" type="text/css" href="{% static 'login/css/signup.css' %}" />
		{% endblock %}
		{% block extra_js %}
			<script src="{% static 'login/js/countryStateCityLoader.js' %}"></script>
		{% endblock %}
		{% block content %}
		{% if user %}
		<section id="profile">
				<div class="profilePic">
					{% if user.socialaccount_set.all %}
					  {% if user.extendeduser.imageUrl %}
						<img src="{{ user.extendeduser.imageUrl }}" alt="User {{ user.first_name }}">
					  {% endif %}
					{% else %}
					  {% if user.extendeduser.imageUrl %}
						<img src="/media/profile/{{ user.extendeduser.get_profile_pic_name }}" alt="User {{ user.first_name }}">
					  {% else %}
						<img src="/static/login/images/defaultAvatar.png"  alt="User {{ user.first_name }}">
					  {% endif %}
					{% endif %}
				</div>
				<div class="profileContent">
					<ul class="tabs clearfix">
						<ul class="insideTabs clearfix">
							<li class="firstChild">
								<input type="radio" name="tabs" id="tab1" checked />
								<label class="tabsLabel" for="tab1">About Me</label>
								<div id="tabContent1" class="tabContent">
									<form class="signupContentForm" method="POST" action="{% url 'login:edit_profile' %}" enctype="multipart/form-data">
										<!-- <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}"> -->
										{% csrf_token %}
										{{ loggedInForm.as_p }}
										<!-- <p>
											<label for="name">Name</label>
											<input id="name" type="text" name="name" value=" {{ user.first_name}} {{ user.last_name }}">
										</p>
										<p>
											<label for="userName">User Name</label>
											<input id="userName" type="text" name="userName" value=" {{ user.username }}" readonly>							
										</p>
										<p>
											<label for="email">Email</label>
											<input id="email" type="text" name="email" value=" {{ user.email }}" readonly>							
										</p>
										<p class="bioCss clearfix">
											<label for="bio">Bio</label>
											<textarea id ="bio" cols="40" rows="5" name="bio" value=" {{ user.extendeduser.bio }}" >{{ user.extendeduser.bio }}</textarea>
										</p>
										<p>
											<label for="gender">Gender</label>
											<input type="radio" id="gender" name="gender" value="M" {% ifequal user.extendeduser.gender "M"%} checked="checked"{% endifequal %}>Male <input type="radio" id="gender" name="gender" value="F" {% ifequal user.extendeduser.gender "F"%} checked="checked"{% endifequal %}>Female
										</p>
										<p>
											<label for="dob">DOB</label>
											<input id="dob" type="date" name="dob" value="{{ user.extendeduser.birthDay|date:'Y-m-d' }}" >
										</p>
										<p>
											<label for="prof">Profession</label>
											<input id="prof" type="text" name="prof" value="{{ user.extendeduser.profession }}" >
										</p>
										<p>
											<label for="country">Country</label>
											<input id="country" type="text" name="country" value="{{ user.extendeduser.country }}" >
										</p>
										<p>
											<label for="state">State</label>
											<input id="state" type="text" name="state" value="{{ user.extendeduser.state }}" >
										</p>	
										<p>
											<label for="city">City</label>
											<input id="city" type="text" name="city" value="{{ user.extendeduser.city }}" >
										</p> -->
										<input id="submit" type="submit" value="Save Changes" />
									</form>
								</div>
							</li>
							<li class="secondChild">
								<input type="radio" name="tabs" id="tab2" unchecked />
								<label class="tabsLabel" for="tab2">Stats</label>
								<div id="tabContent2" class="tabContent">
									<div class="stats">
										<div class="stat">
											<input type="radio" id="stat-1" name="stat-group-1" checked>
												<label for="stat-1">Asked Polls</label>
													<div class="content">
														{% for question in questions %}
														<div class="searchResults">
	          												<div class="result">
	            												<p>
																	<a href="{% url 'polls:polls_detail' question.id question.que_slug %}">{{ question.question_text }}</a>
																</p>
															</div>
														</div>
														{% endfor %}
													</div>
										</div>
										<div class="stat">
											<input type="radio" id="stat-2" name="stat-group-1">
												<label for="stat-2">Voted Polls</label>           
													<div class="content">
													</div> 
										</div>
										<div class="stat">
											<input type="radio" id="stat-3" name="stat-group-1">
												<label for="stat-3">Recent Activity</label>
													<div class="content">
													</div> 
										</div>
										<div class="stat">
											<input type="radio" id="stat-4" name="stat-group-1">
												<label for="stat-4">Statistics</label>
													<div class="content">
													</div> 
										</div>
									</div>
								</div>
							</li>
							<li class="thirdChild">
								<input type="radio" name="tabs" id="tab3" unchecked />
								<label class="tabsLabel" for="tab3">Settings</label>
								<div id="tabContent3" class="tabContent">
									<ul>
										<li>
											<div id="changePassword">
												<p>Change Password</p>
												<form action="{% url 'account_login' %}" method="get" class="password_change" id="password_change_form">
										    		{% csrf_token %}
										    		{{ form.as_p }}
										    		<button type="submit" name="action">Change Password</button>
										    		<!-- <input type="submit" value="Submit" /> -->
												</form>
											</div>
										</li>
									</ul>
								</div>
							</li>
					    </ul>
					</ul>
				</div>
		</section>
		<script type="text/javascript">
			$(document).ready(function()
		    {
		  		$('#password_change_form').bind('submit', function()
	            {     

	                // e.preventDefault();
	                $.ajax(
	                    {
	                    type: 'POST',
	                    url:'/loggedin/changepassword',
	                    data:$('#password_change_form').serialize(),
	                    success:function(response)
	                    {
	                    	var form_errors = response.form_errors;
	                    	console.log(response.form_errors);
	                    	console.log(typeof form_errors === 'undefined');

	                    	if(typeof form_errors === 'undefined'){
	                        	 $('#password_change_form').unbind('submit').submit();
	                        }else{
	                        	console.log(form_errors.oldpassword);
		                    	console.log(form_errors.password1);
		                    	console.log(form_errors.password2);
		                    	if(typeof form_errors.oldpassword === 'undefined')
	                        	 	form_errors.oldpassword = "";
	                        	 if(typeof form_errors.password1 === 'undefined')
	                        	 	form_errors.password1 = "";
	                        	 if(typeof form_errors.password2 === 'undefined')
	                        	 	form_errors.password2 = "";
		                    	$(".password_form_errors").remove();
		                        $("#id_oldpassword").parent().append('<span class="password_form_errors"><br>'+form_errors.oldpassword+'</span>');
		                        $("#id_password1").parent().append('<span class="password_form_errors"><br>'+form_errors.password1+'</span>');
		                        $("#id_password2").parent().append('<span class="password_form_errors"><br>'+form_errors.password2+'</span>');
	                    	}
	                    }
	                });     
				return false;
	            });
		    });
		</script>
	{% endif %}
	{% endblock %}