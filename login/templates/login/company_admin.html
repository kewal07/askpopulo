{% extends "polls/common.html" %}
{% load static %}
{% load activity_tags %}
{% load get_name %}
{% block extra_css %}
	<link rel="stylesheet" type="text/css" href="{% static 'polls/css/jquery-ui.css' %}" />
	<link rel="stylesheet" type="text/css" href="{% static 'login/css/public_profile.css' %}" />
	<link rel="stylesheet" type="text/css" href="{% static 'polls/css/questionDetail.css' %}" />
	<link rel="stylesheet" type="text/css" href="{% static 'polls/css/createPoll.css' %}" />
	<link rel="stylesheet" type="text/css" href="{% static 'login/css/company_admin.css' %}" />
{% endblock %}
{% block extra_js %}
	<!--Remove this and also chart.js<script src="{% static 'login/js/Chart.js' %}" ></script> -->
	<!--<script type='text/javascript' src="https://www.google.com/jsapi?autoload={'modules':[{'name':'visualization','version':'1.1','packages':['bar','PieChart']}]}"></script>-->
	<script type="text/javascript" src="{% static 'js/d3.js' %}"></script>
	<script type="text/javascript" src="https://www.google.com/jsapi"></script>
	<script type="text/javascript" src="{% static 'login/js/company_admin.js' %}"></script>
	<script type="text/javascript" src="{% static 'login/js/countryStateCityLoader.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/jquery.csv-0.71.min.js' %}"></script>
	<script src="{% static 'js/jquery-ui.js' %}"></script>
	<script src="{% static 'js/jquery.autocomplete.multiselect.js' %}"></script>
{% endblock %}
{% block content %}
	<div id="mobile-dashboard">
		<p>Dashboard is currently available only on Desktops and would be coming soon to mobiles as well. If you require special assistance please contact support.</p>
	</div>
	<section id="admin-dashboard" class="clearfix">
		<div id="dashboard-menu" class="clearfix">
			<ul class="dashboard-menu-items clearfix">
				<li class="dashboard-menu-li selectedLi">Dashboard</li>
				<li class="dashboard-menu-li">Polls</li>
				<li class="dashboard-menu-li">Surveys</li>
				<li class="dashboard-menu-li">Followers</li>
				<li class="dashboard-menu-li">Groups</li>
				<li class="dashboard-menu-li">Messages</li>
				<li class="dashboard-menu-li">Feed</li>
				<li class="dashboard-menu-li">Advanced</li>
				<li class="dashboard-menu-li">Export</li>
				<li class="dashboard-menu-li">Billing</li>
			</ul>
		</div>
		<div id="dashboard-content" class="admin-dash-div clearfix">
			<div class="dashboard-header">
				<p>Dashboard</p>
			</div>
			<div class="dashboard-stats">
				<ul class="dashboard-stats-ul">
					<li class="first-li">{{ polls_count }} Poll{{ polls_count|pluralize }} <span class="see-more-details">Details</span></li>
					<li class="second-li">{{ followers_count }} Follower{{ followers_count|pluralize }} <span class="see-more-details">Details</span></li>
					<li class="third-li">{{ credits }} pCoin{{ credits|pluralize }} <span class="see-more-details">Details</span></li>
				</ul>
				<div class="graphs-cube">
					<div class="graph-admin">
						<div id="chart_div">
							<script>
								 google.setOnLoadCallback(drawChart);
						      	function drawChart() {
								console.log("chart draw called");
						      		var dashboardData = [['Month', 'Polls', 'Views', 'Votes']];
									{% for dash_dict in dash_graph %}
										var dash_list = ["{{ dash_dict.month_name }}",{{ dash_dict.polls }},{{ dash_dict.views }},{{ dash_dict.votes }}];
										dashboardData.push(dash_list)
									{% endfor %}
									// console.log(dashboardData);
									var data = google.visualization.arrayToDataTable(dashboardData);
									console.log(dashboardData);

							        var options = {
							          chart: {
							            title: 'Polls, Views, and Votes: Last 3 months', 
							          },
							          bars: 'horizontal', // Required for Material Bar Charts.
							          hAxis: {format: 'decimal'},
							          height: 400,
							          colors: ['#1b9e77', '#d95f02', '#7570b3']
							        };

							        var chart = new google.charts.Bar(document.getElementById('chart_div'));
									console.log(dashboardData);

							        chart.draw(data, google.charts.Bar.convertOptions(options));
									console.log(dashboardData);
						      }
							</script>
						</div>
					</div>
					<div class="cube-admin">
						<div id="cube">
							<div class="face" id="f2"><span class="cube-num">{{ total_views }}</span><span class="cube-text">Views</span></div>
							<div class="face" id="f3"><span class="cube-num">7</span><span class="cube-text">Active Users</span></div>
							<div class="face" id="f4"><span class="cube-num">{{ votes_count }}</span><span class="cube-text">Votes</span></div>
							<div class="face" id="f5"><span class="cube-num">{{ following_count }}</span><span class="cube-text">Following</span></div>
						</div>
					</div>
				</div>
				<ul class="dashboard-recent">
					<li>Recent Activity </li>
					{% for activity in flat_feed_activities|slice:":5" %}
					<li>
						<div class="liDetail">
							{% if activity.verb == "question" %}
								<a href="{{ activity.actor_user_url }}"><img class="imgInFeed" src="{{ activity.actor_user_pic }}"> </a>
								<div><p class="main"><span class="activity_text"><a href="{{ activity.actor_user_url }}"><span class="activity_url">{{ user.username|getName:activity.actor_user_name }}</span> </a>asked 
								{% if user.id != context_user.id and not activity.visible_public %}
								a private/anonymous poll 
								{% else %}
								<a href="{{ activity.question_url }}"><span class="activity_url">{{ activity.question_text }}</span></a> 
								{% endif %}
								<span id="activity{{ activity.id }}"> </span></span>
							{% elif activity.verb == "voted" %}
								<a href="{{ activity.actor_user_url }}"><img class="imgInFeed" src="{{ activity.actor_user_pic }}"> </a>
								<div><p class="main"><span class="activity_text"><a href="{{ activity.actor_user_url }}"><span class="activity_url">{{ user.username|getName:activity.actor_user_name }}</span> </a>voted on {% if user.id != context_user.id and not activity.visible_public %}
								a private poll 
								{% else %}
								<a href="{{ activity.question_url }}"><span class="activity_url">{{ activity.question_text }}</span></a> 
								{% endif %} <span id="activity{{ activity.id }}"> </span></span>
							{% elif activity.verb == "votedBet" %}
								<a href="{{ activity.actor_user_url }}"><img class="imgInFeed" src="{{ activity.actor_user_pic }}"> </a>
								<div><p class="main"><span class="activity_text"><a href="{{ activity.actor_user_url }}"><span class="activity_url">{{ user.username|getName:activity.actor_user_name }}</span> </a>voted on {% if user.id != context_user.id and not activity.visible_public %}
								a private poll 
								{% else %}
								<a href="{{ activity.question_url }}"><span class="activity_url">{{ activity.question_text }}</span></a> 
								{% endif %} putting {{ activity.points }} credits <span id="activity{{ activity.id }}"> </span></span>
							{% elif activity.verb == "follow" or activity.verb == "followed" %}
								<a href="{{ activity.actor_user_url }}"><img class="imgInFeed" src="{{ activity.actor_user_pic }}"> </a>
								<div><p class="main"><span class="activity_text"><a href="{{ activity.actor_user_url }}"><span class="activity_url">{{ user.username|getName:activity.actor_user_name }}</span> </a>followed <a href="{{ activity.target_user_url }}"><span class="activity_url">{{ user.username|getName:activity.target_user_name }}</span></a> <span id="activity{{ activity.id }}"> </span></span>
							{% else %}
								<a href="{{ activity.actor_user_url }}"><img class="imgInFeed" src="{{ activity.actor_user_pic }}"> </a>
								<div><p class="main"><span class="activity_text"><a href="{{ activity.actor_user_url }}"><span class="activity_url">{{ user.username|getName:activity.actor_user_name }}</span> </a>{{ activity.verb}} <a href="{{ activity.question_url }}"><span class="activity_url">{{ activity.question_text }}</span></a> <span id="activity{{ activity.id }}"> </span></span>
							{% endif %}
							{% if activity.verb != "credits"  %}
								</p>
								<p class="desc">{{ activity.question_desc }}</p>
								</div>
							{% endif %}
						</div>
						<script>
							var currentDate = new Date();
							var offset = currentDate.getTimezoneOffset();
							var serverActivityDate = new Date({{ activity.time.year }}, {{ activity.time.month }} - 1, {{ activity.time.day }}, {{ activity.time.hour }}, {{ activity.time.minute }}, {{ activity.time.second }});
							var localActvityDate = new Date({{ activity.time.year }}, {{ activity.time.month }} - 1, {{ activity.time.day }}, {{ activity.time.hour }}, {{ activity.time.minute }}-offset, {{ activity.time.second }});
							$('#activity{{ activity.id }}').text(' '+jQuery.timeago(localActvityDate).toString());
						</script>
					</li>
					{% endfor %}<span class="see-more-details">Details</span>
				</ul>
			</div>
		</div>
		<div id="polls-content" class="admin-dash-div clearfix">
			<div class="dashboard-header">
				<p>Polls</p>
			</div>
			<div class="dashboard-stats clearfix">
				<ul class="dashboard-recent">
					<li> Polls Asked</li>
					{% for question in polls %}
					<li class="li-margin-polls">
						<div class="liDetail">
							<div class="check_analyse">
							<p class="main activity_url analyse_question_text" id="analyse---{{ question.poll.id }}">
								{{question.poll.question_text}}
							</p>
							<p class="pollsDesc">{{ question.poll.description }}</p>
							<p class="check"><span class="see-more-details see-more-details-p question-u"><a href="{% url 'polls:polls_vote' question.poll.id question.poll.que_slug %}">Go To Question</a></span><span class="see-more-details see-more-details-p">{{ question.votes }} Vote{{ question.votes|pluralize }}</span></p>
							</div>
						</div>
						<div class="analysis" id="analyse---{{ question.poll.id }}Div">
							<div class="choices clearfix">
							{% for choice in question.poll.choice_set.all %}
							{% if choice.choice_image %}
								<figure>
									<img class="choiceImage choiceDetailImage" src="/media/choices/{{ choice.get_file_name }}" alt="{{ choice.choice_text }}">
									<figcaption class="choiceFigCaption">
										{% if choice.choice_text %}
											Choice{{ forloop.counter }} : {{ choice.choice_text }}
										{% else %}
											Choice{{ forloop.counter }}
										{% endif %}
									</figcaption>
								</figure>
							{% else %}
								Choice{{ forloop.counter }} : "{{ choice.choice_text }}"
								<br/>
							{% endif %}
							{% endfor %}
							</div>
							<div id="pollsChart---{{ question.poll.id }}" class="pollsChartClass">
							</div>
							<select class="analyseSelect" id="analyse---{{ question.poll.id }}Select">
								<option value="nochoice">Select</option>
								{% for choice in question.poll.choice_set.all %}
									<option value="choice{{ choice.id }}">Choice {{ forloop.counter }}</option>
								{% endfor %}
							</select>
							<div class="gender">
								<div class="graphContainer">
									<p> Gender </p>
									<div class="question_analyse_chart" id="genderChart---{{ question.poll.id }}">
									</div>
								</div>
							</div>
							<div class="age">
								<div class="graphContainer">
									<p> Age </p>
									<div class="question_analyse_chart" id="ageChart---{{ question.poll.id }}">
									</div>
								</div>
							</div>
							<div class="location">
								<div class="graphContainer">
									<p> Location </p><div id="mapBackButton---{{ question.poll.id }}" class="back" onClick="back('',{{ question.poll.id }})"><i class="fa fa-arrow-left"></i></div>
									<div class="question_analyse_chart_loc" id="locationChart---{{ question.poll.id }}">
									</div>
								</div>
							</div>
							<div class="others">
								<div class="graphContainer">
									<p> Profession </p>
									<div class="question_analyse_chart" id="othersChart---{{ question.poll.id }}">
									</div>
								</div>
							</div>
						</div>
					</li>
					{% endfor %}
				</ul>
			</div>
		</div>
		<div id="surveys-content" class="admin-dash-div clearfix">
			<div class="dashboard-header">
				Surveys
			</div>
			<div class="dashboard-stats clearfix">
				<p id="create-new-survey" onclick="createSurvey()"> Create New </p>
				<ul class="dashboard-recent">
					<li> Survey</li>
				</ul>
			</div>
			<div class="create-survey">
				<form id="create-survey-form" class="create-survey-content-form" method="POST" action="{% url 'polls:create_survey' %}"  enctype="multipart/form-data">
					{% csrf_token %}
					<p class="form-p">
						<label class="required" for="surveyName">Name</label>
						<input type="text" id ="surveyName" name="surveyName" placeholder="Survey Name" maxlength="64"></input>
					</p>
					<p class="form-p">
						<label class="required" for="surveyDescription">Description</label>
						<textarea id ="surveyDescription" name="surveyDescription" placeholder="Description"></textarea>
					</p>
					<p class="form-p">
						<label for="qExpiry">Expires On</label>
						<select id="qExpiry_month" name="qExpiry_month">
								<option value="0">Month</option>
								<option value="1">January</option>
								<option value="2">February</option>
								<option value="3">March</option>
								<option value="4">April</option>
								<option value="5">May</option>
								<option value="6">June</option>
								<option value="7">July</option>
								<option value="8">August</option>
								<option value="9">September</option>
								<option value="10">October</option>
								<option value="11">November</option>
								<option value="12">December</option>
						</select>
						<select id="qExpiry_day" name="qExpiry_day">
								<option value="0">Day</option>
								<option value="1">1</option>
								<option value="2">2</option>
								<option value="3">3</option>
								<option value="4">4</option>
								<option value="5">5</option>
								<option value="6">6</option>
								<option value="7">7</option>
								<option value="8">8</option>
								<option value="9">9</option>
								<option value="10">10</option>
								<option value="11">11</option>
								<option value="12">12</option>
								<option value="13">13</option>
								<option value="14">14</option>
								<option value="15">15</option>
								<option value="16">16</option>
								<option value="17">17</option>
								<option value="18">18</option>
								<option value="19">19</option>
								<option value="20">20</option>
								<option value="21">21</option>
								<option value="22">22</option>
								<option value="23">23</option>
								<option value="24">24</option>
								<option value="25">25</option>
								<option value="26">26</option>
								<option value="27">27</option>
								<option value="28">28</option>
								<option value="29">29</option>
								<option value="30">30</option>
								<option value="31">31</option>
						</select>
						<select id="qExpiry_year" name="qExpiry_year">
								<option value="0">Year</option>
								<option value="2015">2015</option>
								<option value="2016">2016</option>
								<option value="2017">2017</option>
								<option value="2018">2018</option>
								<option value="2019">2019</option>
								<option value="2020">2020</option>
								<option value="2021">2021</option>
								<option value="2022">2022</option>
								<option value="2023">2023</option>
								<option value="2024">2024</option>
								<option value="2025">2025</option>
								<option value="2026">2026</option>
								<option value="2027">2027</option>
								<option value="2028">2028</option>
								<option value="2029">2029</option>
								<option value="2030">2030</option>
								<option value="2031">2031</option>
								<option value="2032">2032</option>
								<option value="2033">2033</option>
								<option value="2034">2034</option>
								<option value="2035">2035</option>
								<option value="2036">2036</option>
								<option value="2037">2037</option>
								<option value="2038">2038</option>
								<option value="2039">2039</option>
								<option value="2040">2040</option>
								<option value="2041">2041</option>
								<option value="2042">2042</option>
								<option value="2043">2043</option>
								<option value="2044">2044</option>
								<option value="2045">2045</option>
								<option value="2046">2046</option>
								<option value="2047">2047</option>
								<option value="2048">2048</option>
								<option value="2049">2049</option>
								<option value="2050">2050</option>
								<option value="2051">2051</option>
								<option value="2052">2052</option>
								<option value="2053">2053</option>
								<option value="2054">2054</option>
								<option value="2055">2055</option>
								<option value="2056">2056</option>
								<option value="2057">2057</option>
								<option value="2058">2058</option>
								<option value="2059">2059</option>
								<option value="2060">2060</option>
								<option value="2061">2061</option>
								<option value="2062">2062</option>
								<option value="2063">2063</option>
								<option value="2064">2064</option>
								<option value="2065">2065</option>
								<option value="2066">2066</option>
								<option value="2067">2067</option>
								<option value="2068">2068</option>
								<option value="2069">2069</option>
								<option value="2070">2070</option>
								<option value="2071">2071</option>
								<option value="2072">2072</option>
								<option value="2073">2073</option>
								<option value="2074">2074</option>
								<option value="2075">2075</option>
								<option value="2076">2076</option>
								<option value="2077">2077</option>
								<option value="2078">2078</option>
								<option value="2079">2079</option>
								<option value="2080">2080</option>
								<option value="2081">2081</option>
								<option value="2082">2082</option>
								<option value="2083">2083</option>
								<option value="2084">2084</option>
								<option value="2085">2085</option>
								<option value="2086">2086</option>
								<option value="2087">2087</option>
								<option value="2088">2088</option>
								<option value="2089">2089</option>
								<option value="2090">2090</option>
								<option value="2091">2091</option>
								<option value="2092">2092</option>
								<option value="2093">2093</option>
								<option value="2094">2094</option>
								<option value="2095">2095</option>
								<option value="2096">2096</option>
								<option value="2097">2097</option>
								<option value="2098">2098</option>
								<option value="2099">2099</option>
								<option value="2100">2100</option>
								<option value="2101">2101</option>
								<option value="2102">2102</option>
								<option value="2103">2103</option>
								<option value="2104">2104</option>
								<option value="2105">2105</option>
								<option value="2106">2106</option>
								<option value="2107">2107</option>
								<option value="2108">2108</option>
								<option value="2109">2109</option>
								<option value="2110">2110</option>
								<option value="2111">2111</option>
								<option value="2112">2112</option>
								<option value="2113">2113</option>
								<option value="2114">2114</option>
								<option value="2115">2115</option>
						</select>
						<select name="qExpiry_hr" id="qExpiry_hr">
								<option value="0">hr</option>
								<option value="1">1</option>
								<option value="2">2</option>
								<option value="3">3</option>
								<option value="4">4</option>
								<option value="5">5</option>
								<option value="6">6</option>
								<option value="7">7</option>
								<option value="8">8</option>
								<option value="9">9</option>
								<option value="10">10</option>
								<option value="11">11</option>
								<option value="12">12</option>
						</select>
						<select name="qExpiry_min" id="qExpiry_hr">
								<option value="-1">min</option>
								<option value="0">0</option>
								<option value="1">1</option>
								<option value="2">2</option>
								<option value="3">3</option>
								<option value="4">4</option>
								<option value="5">5</option>
								<option value="6">6</option>
								<option value="7">7</option>
								<option value="8">8</option>
								<option value="9">9</option>
								<option value="10">10</option>
								<option value="11">11</option>
								<option value="12">12</option>
								<option value="13">13</option>
								<option value="14">14</option>
								<option value="15">15</option>
								<option value="16">16</option>
								<option value="17">17</option>
								<option value="18">18</option>
								<option value="19">19</option>
								<option value="20">20</option>
								<option value="21">21</option>
								<option value="22">22</option>
								<option value="23">23</option>
								<option value="24">24</option>
								<option value="25">25</option>
								<option value="26">26</option>
								<option value="27">27</option>
								<option value="28">28</option>
								<option value="29">29</option>
								<option value="30">30</option>
								<option value="31">31</option>
								<option value="32">32</option>
								<option value="33">33</option>
								<option value="34">34</option>
								<option value="35">35</option>
								<option value="36">36</option>
								<option value="37">37</option>
								<option value="38">38</option>
								<option value="39">39</option>
								<option value="40">40</option>
								<option value="41">41</option>
								<option value="42">42</option>
								<option value="43">43</option>
								<option value="44">44</option>
								<option value="45">45</option>
								<option value="46">46</option>
								<option value="47">47</option>
								<option value="48">48</option>
								<option value="49">49</option>
								<option value="50">50</option>
								<option value="51">51</option>
								<option value="52">52</option>
								<option value="53">53</option>
								<option value="54">54</option>
								<option value="55">55</option>
								<option value="56">56</option>
								<option value="57">57</option>
								<option value="58">58</option>
								<option value="59">59</option>
						</select>
						<select name="qExpiry_ap" id="qExpiry_ap">
								<option value="AM">AM</option>
								<option value="PM">PM</option>
						</select>
					</p>
					<p class="form-p">
						<label for="categories">Category <i id="category_tooltip_fa" class="fa fa-info-circle"></i></label>
						<input id="categories" type="text" name="categories" style="border:none;">
						<input id="selectedCategories" type="hidden" name="selectedCategories" value="">
					</p>
					<div class="survey-questions">
					</div>
					<i class="fa fa-plus-circle add-q">Add Question</i>
					<input class="submit surveySubmit" type="submit" value="Create" id="createSurveySubmit"/>
				</form>
				<div class="tooltip" id="category_tooltip">
					<span>Categories list:<br></span>
					{% for cat in categories %}
						<span class="cat_title_tooltip">{{ cat }},    </span>
					{% endfor %}
				</div>
			</div>
		</div>
		<div id="followers-content" class="admin-dash-div clearfix">
			<div class="dashboard-header">
				<p>Followers</p>
			</div>
			<div class="dashboard-stats clearfix">
				<ul class="dashboard-recent">
					{% for act_user in followers %}
						<li class="followers">	
							<a href="{% url 'login:loggedIn' act_user.id act_user.extendeduser.user_slug %}">
								<figure>
									<img class="imgInFeed follow" src="{{ act_user.extendeduser.get_profile_pic_url }}">
									<figcaption class="activity_url follow_url">
										{{ act_user.username }}
									</figcaption>
								</figure>
							</a>
						</li>
					{% endfor %}
				</ul>
			</div>
		</div>
		<div id="groups-content" class="admin-dash-div clearfix">
			<div class="dashboard-header">
				Groups
			</div>
			<div class="dashboard-stats clearfix">
				<p id="create-new-group" onclick="createGroup()"> Create New </p>
				<ul class="dashboard-recent">
					<li> Groups</li>
					{% for group in groups %}
						<li class="li-margin-polls">
							<div class="liDetail">
								<div class="check_analyse">
									<p class="main activity_url analyse_question_text" id="analyse---{{ question.poll.id }}">
										{{group.groupName}}
									</p>
								</div>
							</div>
							<div class="analysis group-ana-member" id="analyse---{{ group.id }}Div">
								<div class="groupMembers clearfix">
									{% for member in group.groupMembers %}
										<a href="{% url 'login:loggedIn' member.id member.extendeduser.user_slug %}">
											<figure class="members-figure">
											  <img class="groupsMemberProfilePic" src="{{ member.extendeduser.get_profile_pic_url }}" alt="{{ member.first_name }}">
											  <figcaption class="members-figcaption">{{ member.first_name }} {{ member.last_name }}</figcaption>
											</figure>
										</a>
									{% endfor %}
								</div>
							</div>
						</li>
					{% endfor %}
				</ul>
			</div>
			<div class="create-group">
				<form id="create-group-form" class="create-group-content-form" method="POST" action="{% url 'login:create_group' %}"  enctype="multipart/form-data">
					{% csrf_token %}
					<p class="form-p">
						<label class="required" for="groupName">Name</label>
						<input type="text" id ="groupName" name="groupName" placeholder="Group Name" maxlength="64"></input>
					</p>
					<p class="form-p">
						<label class="required" for="groupMembers">Members</label>
						<textarea id ="groupMembers" name="groupMembers" placeholder="Group Members"></textarea>
					</p>
					<p>
				        <label for="csvUpload">Upload your CSV File</label>
				        <input type="file" name="File Upload" id="csvUpload" accept=".csv" />
					</p>
					<input class="submit groupSubmit" type="submit" value="Create" id="createGroupSubmit"/>
				</form>
			</div>
		</div>
		<div id="messages-content" class="admin-dash-div clearfix">
			<div class="dashboard-header">
				<p>Messages</p>
			</div>
		</div>
		<div id="feed-content" class="admin-dash-div clearfix">
			<div class="dashboard-header">
				<p>My Feed</p>
			</div>
			<div class="dashboard-stats clearfix">
				<ul class="dashboard-recent">
					<!-- <li> My Feed</li> -->
					{% for activity in activities %}
					<li class="feed-admin">
						<div class="liDetail">
							{% if activity.verb == "question" %}
								<a href="{{ activity.actor_user_url }}"><img class="imgInFeed" src="{{ activity.actor_user_pic }}"> </a>
								<div><p class="main"><span class="activity_text"><a href="{{ activity.actor_user_url }}"><span class="activity_url">{{ user.username|getName:activity.actor_user_name }}</span> </a>asked {% if user.id != context_user.id and not activity.visible_public %}
								a private/anonymous poll 
								{% else %}
								<a href="{{ activity.question_url }}"><span class="activity_url">{{ activity.question_text }}</span></a> 
								{% endif %}
								<span id="activity{{ activity.id }}"> </span>
							{% elif activity.verb == "questionBet" %}
								<a href="{{ activity.actor_user_url }}"><img class="imgInFeed" src="{{ activity.actor_user_pic }}"> </a>
								<div><p class="main"><span class="activity_text"><a href="{{ activity.actor_user_url }}"><span class="activity_url">{{ user.username|getName:activity.actor_user_name }}</span> </a>asked {% if user.id != context_user.id and not activity.visible_public %}
								a private/anonymous poll 
								{% else %}
								<a href="{{ activity.question_url }}"><span class="activity_url">{{ activity.question_text }}</span></a> 
								{% endif %} putting {{ activity.points }} credits <span id="activity{{ activity.id }}"> </span></span>
							{% elif activity.verb == "voted" %}
								<a href="{{ activity.actor_user_url }}"><img class="imgInFeed" src="{{ activity.actor_user_pic }}"> </a>
								<div><p class="main"><span class="activity_text"><a href="{{ activity.actor_user_url }}"><span class="activity_url">{{ user.username|getName:activity.actor_user_name }}</span> </a>{{ activity.verb}} {% if user.id != context_user.id and not activity.visible_public %}
								a private/anonymous poll 
								{% else %}
								<a href="{{ activity.question_url }}"><span class="activity_url">{{ activity.question_text }}</span></a> 
								{% endif %}<span id="activity{{ activity.id }}"> </span></span>
							{% elif activity.verb == "votedBet" %}
								<a href="{{ activity.actor_user_url }}"><img class="imgInFeed" src="{{ activity.actor_user_pic }}"> </a>
								<div><p class="main"><span class="activity_text"><a href="{{ activity.actor_user_url }}"><span class="activity_url">{{ user.username|getName:activity.actor_user_name }}</span> </a>voted on {% if user.id != context_user.id and not activity.visible_public %}
								a private/anonymous poll 
								{% else %}
								<a href="{{ activity.question_url }}"><span class="activity_url">{{ activity.question_text }}</span></a> 
								{% endif %} putting {{ activity.points }} credits<span id="activity{{ activity.id }}"> </span></span>
							{% elif activity.verb == "follow" or activity.verb == "followed" %}
								<a href="{{ activity.actor_user_url }}"><img class="imgInFeed" src="{{ activity.actor_user_pic }}"> </a>
								<div><p class="main"><span class="activity_text"><a href="{{ activity.actor_user_url }}"><span class="activity_url">{{  user.username|getName:activity.actor_user_name }}</span> </a>followed <a href="{{ activity.target_user_url }}"><span class="activity_url">{{ user.username|getName:activity.target_user_name }}</span></a><span id="activity{{ activity.id }}"> </span></span>
							{% else %}
								<a href="{{ activity.actor_user_url }}"><img class="imgInFeed" src="{{ activity.actor_user_pic }}"> </a>
								<div><p class="main"><span class="activity_text"><a href="{{ activity.actor_user_url }}"><span class="activity_url">{{ user.username|getName:activity.actor_user_name }}</span> </a>{{ activity.verb}} <a href="{{ user.username|getName:activity.target_user_name }}"><span class="activity_url"></a><span id="activity{{ activity.id }}"> </span></span>
							{% endif %}
							{% if activity.verb != "credits"  %}
								</p>
								{% if activity.visible_public %}
									<p class="desc">{{ activity.question_desc }}</p>
								{% endif %}
								</div>
							{% endif %}
						</div>
						<script>
							var currentDate = new Date();
							var offset = currentDate.getTimezoneOffset();
							var serverActivityDate = new Date({{ activity.time.year }}, {{ activity.time.month }} - 1, {{ activity.time.day }}, {{ activity.time.hour }}, {{ activity.time.minute }}, {{ activity.time.second }});
							var localActvityDate = new Date({{ activity.time.year }}, {{ activity.time.month }} - 1, {{ activity.time.day }}, {{ activity.time.hour }}, {{ activity.time.minute }}-offset, {{ activity.time.second }});
							$('#activity{{ activity.id }}').text(' '+jQuery.timeago(localActvityDate).toString());
						</script>
					</li>
					{% endfor %}
				</ul>
			</div>
		</div>
		<div id="advanced-content" class="admin-dash-div clearfix">
			<div class="dashboard-header">
				<p>Polls</p>
			</div>
			<div class="dashboard-stats clearfix">
				<ul class="dashboard-recent">
					<li> Polls Asked</li>
					{% for question in polls %}
					<li class="li-margin-polls">
						<div class="liDetail">
							<div class="check_analyse">
							<p class="main activity_url analyse_question_text" id="advanced-analyse---{{ question.poll.id }}">
								{{question.poll.question_text}}
							</p>
							<p class="pollsDesc">{{ question.poll.description }}</p>
							<p class="check"><span class="see-more-details see-more-details-p question-u"><a href="{% url 'polls:polls_vote' question.poll.id question.poll.que_slug %}">Go To Question</a></span><span class="see-more-details see-more-details-p">{{ question.votes }} Vote{{ question.votes|pluralize }}</span></p>
							</div>
						</div>
						<div class="analysis" id="advanced-analyse---{{ question.poll.id }}Div">
							<div class="choices clearfix">
							{% for choice in question.poll.choice_set.all %}
							{% if choice.choice_image %}
								<figure>
									<img class="choiceImage choiceDetailImage" src="/media/choices/{{ choice.get_file_name }}" alt="{{ choice.choice_text }}">
									<figcaption class="choiceFigCaption">
										{% if choice.choice_text %}
											Choice{{ forloop.counter }} : {{ choice.choice_text }}
										{% else %}
											Choice{{ forloop.counter }}
										{% endif %}
									</figcaption>
								</figure>
							{% else %}
								Choice{{ forloop.counter }} : "{{ choice.choice_text }}"
								<br/>
							{% endif %}
							{% endfor %}
							</div>
							<div id="advanced-pollsChart---{{ question.poll.id }}" class="pollsChartClass">
							</div>
							<div id="advancedAna">
								<p style="margin-bottom:1rem;"> Filter by different parameters </p>
								<select class="advancedanalyseSelect" id="advancedanalyse---{{ question.poll.id }}---Gender">
									<option value="nochoice">Gender</option>
									<option value="f">Female</option>
									<option value="m">Male</option>
									<option value="d">Undisclosed</option>
								</select>
								<select class="advancedanalyseSelect" id="advancedanalyse---{{ question.poll.id }}---Age">
									<option value="nochoice">Age</option>
									<option value="<19">< 19</option>
									<option value="20-25">20-25</option>
									<option value="26-30">26-30</option>
									<option value="31-35">31-35</option>
									<option value="36-50">36-50</option>
									<option value=">50">> 50</option>
								</select>
								<select class="advancedanalyseSelect" id="advancedanalyse---{{ question.poll.id }}---Profession">
									<option value="nochoice">Profession</option>
								</select>
								<select class="advancedanalyseSelect advancedanalyseSelectCountry" id="advancedanalyse---{{ question.poll.id }}---Country" name="country">
									<option value="nochoice">Country</option>
								</select>
								<select class="advancedanalyseSelect" id="advancedanalyse---{{ question.poll.id }}---State" name="state">
									<option value="nochoice">State</option>
								</select>
							</div>
							<div id="advancedanalyse-pollsChart---{{ question.poll.id }}" class="pollsChartClass">
							</div>
							<p style="margin-bottom:1rem;text-align:center;"> Or</p>
							<select class="analyseSelect" id="advanced-analyse---{{ question.poll.id }}Select">
								<option value="nochoice">Filter by Choice</option>
								{% for choice in question.poll.choice_set.all %}
									<option value="choice{{ choice.id }}">Choice {{ forloop.counter }}</option>
								{% endfor %}
							</select>
							<div class="gender">
								<div class="graphContainer">
									<p> Gender </p>
									<div class="question_analyse_chart" id="advanced-genderChart---{{ question.poll.id }}">
									</div>
								</div>
							</div>
							<div class="age">
								<div class="graphContainer">
									<p> Age </p>
									<div class="question_analyse_chart" id="advanced-ageChart---{{ question.poll.id }}">
									</div>
								</div>
							</div>
							<div class="location">
								<div class="graphContainer">
									<p> Location </p><div id="advanced-mapBackButton---{{ question.poll.id }}" class="back" onClick="back('advanced-',{{ question.poll.id }})"><i class="fa fa-arrow-left"></i></div>
									<div class="question_analyse_chart_loc" id="advanced-locationChart---{{ question.poll.id }}">
									</div>
								</div>
							</div>
							<div class="others">
								<div class="graphContainer">
									<p> Profession </p>
									<div class="question_analyse_chart" id="advanced-othersChart---{{ question.poll.id }}">
									</div>
								</div>
							</div>
						</div>
					</li>
					{% endfor %}
				</ul>
			</div>
		</div>
		<div id="export-content" class="admin-dash-div clearfix">
			<div class="dashboard-header">
				Coming Soon!
			</div>
			<p class="coming-soon">Export of raw data coming soon.Please contact support for accelerated development.</p>
		</div>
		<div id="billing-content" class="admin-dash-div clearfix">
			<div class="dashboard-header">
				Coming Soon!
			</div>
			<p class="coming-soon">You can buy pCoins and use them to make your polls featured which would ensure greater attention and votes.Please contact support for accelerated development </p>
		</div>
		<script>
			google.load('visualization', '1', {packages: ['corechart', 'bar','geochart']});
			var profList = ["Student","Politics","Education","Information Technology","Public Sector","Social Services","Medical","Finance","Manager","Others"];
			var i;

			var availableTags = [];
			{% for category in categories %}
				console.log(" {{ category.category_title }} ");
				availableTags.push("{{ category.category_title }}");
				console.log(" {{ category.category_title }} ");
			{% endfor %}
			console.log(availableTags);
			
			function validateEmail(field) {
    			var regex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,5}$/;
    			return (regex.test(field)) ? true : false;
			}

			function validateMultipleEmailsCommaSeparated(emailcntl, seperator) {
    			var value = emailcntl;
			    if (value != '') {
			        var result = value.split(seperator);
			        for (var i = 0; i < result.length; i++) {
			            if (result[i] != '') {
			                if (!validateEmail(result[i])) {
			                    alert('Please check, `' + result[i] + '` email addresses not valid!');
			                    return false;
			                }
			            }
			        }
			    }
    			return true;
			}

			 // Method that checks that the browser supports the HTML5 File API
		    function browserSupportFileUpload() {
		        var isCompatible = false;
		        if (window.File && window.FileReader && window.FileList && window.Blob) {
		        isCompatible = true;
		        }
		        return isCompatible;
		    }

			function createGroup(){
				$(".create-group").toggle("slow");
				// Method that reads and processes the selected file
				$("#csvUpload").change(function(evt){
					if (!browserSupportFileUpload()) {
				        alert('The File APIs are not fully supported in this browser!');
				        } else {
				            var data = null;
				            var file = evt.target.files[0];
				            var reader = new FileReader();
				            reader.readAsText(file);
				            reader.onload = function(event) {
				                var csvData = event.target.result;
				                data = $.csv.toArrays(csvData);
				                if (data && data.length > 0) {
				                	var tempEmail="";
				                  	data.forEach(function(entry) {
									   tempEmail += entry+";";
									});
									console.log(tempEmail);
									$("#groupMembers").val(tempEmail);
				                } else {
				                    alert('No data to import!');
				                }
				            };
				            reader.onerror = function() {
				                alert('Unable to read ' + file.fileName);
				            };
				        }

				});
			
				$('.groupSubmit').bind('click', function(event)
				{
					event.preventDefault();
					var elemid = "#create-group-form";
					var form_data = new FormData($(elemid)[0]);
					var emailIdList = $('#groupMembers').val()
					validateMultipleEmailsCommaSeparated(emailIdList,';');
					$("#createGroupSubmit").attr("disabled","disabled");
					{% if user.is_authenticated %}
						$.ajax(
						{
							type: 'POST',
							url:"/user/creategroup",
							data:form_data,
							processData: false,
							contentType: false,
							success:function(response)
							{
								console.log(response);
							}
						});
					{% else %}
						$(location).attr('href',create_url);
					{% endif %}
				});
			}

			function createSurvey(){
				var question_count = 1;
				var choice_count = {};
				$(".create-survey").toggle("slow");
			
				$( "#categories" ).autocomplete({
					source: availableTags,
					multiselect: true,
					maxselection: 5,
					elemId: "selectedCategories"
				});
				$('#id_categories').hide();
				$('#id_categories').prev().append("<span id='cats'>Please Click here to expand and select your categories</span>");
				$('#id_categories').prev().on('click', '#cats', function() {
			    	$('#id_categories').toggle();
			  	});

			  	$("#category_tooltip_fa").hover(function(e){
			  		// console.log($(this));
			  		var elem_pos = $(this).offset();
			  		// console.log(elem_pos.top,elem_pos.left);
			  		$("#category_tooltip").css({
			  			"top":elem_pos.top-100,
			  			"left":elem_pos.left-60,
			  		});
			  		$("#category_tooltip").toggle();
			  	});
			  	$(".add-q").click(function(){
			  		choice_count[question_count] = 1;
			  		var question_id = "question"+(question_count.toString());
			  		var question_count_str = question_count.toString();
			  		var question_elem = '<div class="survey-question-div" id="questionDiv'+question_count_str+'">';
			  		question_elem += '<p class="form-p"><label class=" required" for="qText';
			  		question_elem += question_count_str;
			  		question_elem += '">Question</label><textarea id ="qText';
			  		question_elem += question_count_str;
			  		question_elem += '" name="qText';
			  		question_elem += question_count_str;
			  		question_elem += '" placeholder="Ask the people" maxlength="200"></textarea></p><p class="form-p"><label for="qDesc';
			  		question_elem += question_count_str;
			  		question_elem += '">Description</label><textarea id ="qDesc';
			  		question_elem += question_count_str;
			  		question_elem += '" name="qDesc';
			  		question_elem += question_count_str;
			  		question_elem += '" placeholder="Description" maxlength="400"></textarea></p>';
			  		question_elem += '<p class="form-p"><label for="qType';
			  		question_elem += question_count_str;
			  		question_elem += '">Question Type</label><select class="question-type-select" id="question-type-select'+question_count_str+'"><option value="text">Text</option><option value="radio">Single Select</option><option value="checkbox">Multi Select</option></select><p>';
			  		question_elem += '</div>';
			  		console.log(question_elem);
			  		$(".survey-questions").append(question_elem);
			  		question_count += 1;
			  		function add_another_choice(question_count_select,selectedType){
						var question_choice_count = choice_count[question_count_select];
			  			var choice_elem_div = "question"+question_count_select+"choiceDiv";
			  			var question_div = "questionDiv"+question_count_select;
						var choice_elem_id = question_div+'"choice'+question_choice_count;
						console.log(question_count_select,selectedType,question_div);
						var font_awesome_str = "";
						var choice_elem = "";
						if(selectedType === "radio"){
							font_awesome_str = "";
						} else if(selectedType === "checkbox"){
							font_awesome_str = "";
						}
						if(selectedType != "text"){
							choice_elem += '<p class"form-p">'+ font_awesome_str;
							choice_elem += '<input id="'+choice_elem_id;
							choice_elem += ' class="createPollText" type="text" name="'+choice_elem_id+'" placeholder="Enter Choice" maxlength="200">';
							choice_elem += '<input id="'+choice_elem_id+'" class="fileButtonClass" type="file" name="'+choice_elem_id+'" accept="image/*">';
							choice_elem += '</p>';
							console.log(choice_elem);
							$("#"+choice_elem_div).last().prev().append(choice_elem);
						}
						choice_count[question_count_select]+=1;
					}
			  		$(".question-type-select").change(function(){
			  			var select_elem_id = $(this)[0].id;
			  			var question_count_select = select_elem_id.replace("question-type-select","");
			  			var question_choice_count = choice_count[question_count_select];
			  			var choice_elem_div = "question"+question_count_select+"choiceDiv";
			  			var question_div = "questionDiv"+question_count_select;
						$("#"+choice_elem_div).remove();
			  			console.log($("#"+choice_elem_div));
			  			var selectedType = $("#"+select_elem_id+" option:selected").val();
						if(selectedType != "text"){
							var add_another_choice_elem = '<div id="'+choice_elem_div+'"></div>';
							$("#"+question_div).append(add_another_choice_elem);
						}
						add_another_choice(question_count_select,selectedType);
						$("#"+choice_elem_div).append('<i id="' +question_count_select+'---'+selectedType + '"class="fa fa-plus-circle add-choice">Add Another</i>');
						$(".add-choice").click(function(){
							var elemId = $(this)[0].id;
							var question_count_select1 = elemId.split("---")[0];
							var selectedType1 = elemId.split("---")[1];
							add_another_choice(question_count_select1,selectedType1);
						});
					});
			  	});

				$('.surveySubmit').bind('click', function(event)
				{
					event.preventDefault();
					var elemid = "#create-survey-form";
					var form_data = new FormData($(elemid)[0]);
					form_data['question_count'] = question_count;
					form_data['choice_count'] = choice_count;
					$("#createSurveySubmit").attr("disabled","disabled");
					{% if user.is_authenticated %}
						$.ajax(
						{
							type: 'POST',
							url:"/create_survey",
							data:form_data,
							processData: false,
							contentType: false,
							success:function(response)
							{
								console.log(response);
							}
						});
					{% else %}
						$(location).attr('href',create_url);
					{% endif %}
				});
			}
	
			$(document).ready(function(){
			
				// google.load("visualization", "1", {packages:["corechart"]});
				$	(".dashboard-menu-li").click(function(){
					$(".dashboard-menu-li").removeClass("selectedLi");
					$(this).addClass("selectedLi");
					// console.log($(this)[0].innerHTML);
					var elem_id = $(this)[0].innerHTML.toLowerCase() + "-content";
					 // console.log(elem_id);
					var new_elem_html = "";
					if(elem_id == "messages-content"){
						$("#messages-content").append('<object id="inboxObject" data="/messages/inbox/" style="height:25rem; width:100%;"/>');
						$(".admin-dash-div").hide();
					    $("#"+elem_id).show();
			        }
					else if(elem_id == "dashboard-content"){
						location.reload();
			        }
					else
						$.ajax({
					        url: "{{ request.path }}",
					        type: 'GET',
					        async: false,
					        cache: false,
					        timeout: 30000,
					        error: function(){
					            return true;
					        },
					        success: function(msg){
					        	var new_html = document.createElement('html');
					        	new_html.innerHTML = msg;
					        	// console.log(new_html);
					        	// console.log(typeof(new_html));
					        	// console.log(new_html.getElementsByTagName("div"));
					        	var new_divs = new_html.getElementsByTagName("div");
					        	for (var i = 0, len = new_divs.length; i < len; i++) {
								    if (new_divs[i].id === elem_id) {
								        var result = new_divs[i];
								        // console.log(result)
								        new_elem_html = result.innerHTML;
								        break;
								    }
								}
								// console.log($("#"+elem_id));
					            $("#"+elem_id)[0].innerHTML = new_elem_html;
					            // console.log($("#"+elem_id));
					            $(".admin-dash-div").hide();
					            $("#"+elem_id).show();
					            if(elem_id == "dashboard-content"){
					            	drawChart();
					            }
					            if(elem_id == "advanced-content"){
					            	{% for question in polls %}
							            for (i = 0; i < profList.length; ++i) {
										    var tempOption = '<option value="'+profList[i]+'">'+profList[i]+'</option>';
										    // console.log(tempOption);
										    $("#advancedanalyse---{{ question.poll.id }}---Profession").append(tempOption);
										}
										populateCountry("#advancedanalyse---{{ question.poll.id }}---Country");
									{% endfor %}
								}

						 //    if(elem_id == "dashboard-content"){
							// google.setOnLoadCallback(drawChart);
					  //           	drawChart();
					  //           }
					        }
					    });
				});
				


				$('#polls-content,#groups-content, #advanced-content').on("click","p.analyse_question_text",function(){
					// console.log("SSSSSSSSSSSSSSSSSSSSSSSSSSSSSS");
					// console.log($(this)[0].id);
					var elemId = $(this)[0].id;
					var pollId = elemId.split("---")[1];
					// console.log(elemId);
					// console.log(pollId);
					var analysisDivId = '#'+elemId+"Div";
					// $(".analysis").hide();
					var isMatch = /^advanced-*/.test(elemId);
					// console.log(isMatch);
					var analyse_type = "";
					if(isMatch)
						analyse_type = "advanced-";
			      	$(analysisDivId).toggle("slow");
				  	// $('#mapBackButton---'+pollId).removeClass("back");
			      	var delay=1000; //1 seconds
					setTimeout(function(){
					//your code to be executed after 1 seconds
					if($(analysisDivId).is(':visible')){
					  drawPollsChart(analyse_type,parseInt(pollId))
					  drawGenderChart(analyse_type,parseInt(pollId));
					  drawAgeChart(analyse_type,parseInt(pollId));
					  drawOthersChart(analyse_type,parseInt(pollId));
					  drawLocationChart(analyse_type,parseInt(pollId));
					}
					}, delay); 
			    });  

			    $("#polls-content, #advanced-content").on("change","select.analyseSelect",function(){
			    	var elemId = $(this)[0].id;
					var pollId = elemId.split("---")[1].replace("Select","");
					// console.log(elemId);
					// console.log(pollId);
					var isMatch = /^advanced-*/.test(elemId);
					// console.log(isMatch);
					var analyse_type = "";
					if(isMatch)
						analyse_type = "advanced-";
					var analysisDivId = '#'+analyse_type+'analyse---'+pollId+"Div";
					// console.log(analysisDivId);
					var selectedChoice = $("#"+elemId).val();
					// console.log(selectedChoice);
					if(selectedChoice != "nochoice"){
						var selectedChoiceId = parseInt(selectedChoice.replace("choice",""));
						// $(analysisDivId).hide();
						// $(analysisDivId).toggle("slow");
						// console.log(selectedChoiceId);
						var delay=2000; //1 seconds
						// setTimeout(function(){
						//your code to be executed after 1 seconds
						if($(analysisDivId).is(':visible')){
						  drawGenderChart(analyse_type,parseInt(pollId),selectedChoiceId);
						  drawAgeChart(analyse_type,parseInt(pollId),selectedChoiceId);
						  drawOthersChart(analyse_type,parseInt(pollId),selectedChoiceId);
						  drawLocationChart(analyse_type,parseInt(pollId),selectedChoiceId);
						}
						// }, delay); 
					}else{
						if($(analysisDivId).is(':visible')){
						  drawGenderChart(analyse_type,parseInt(pollId));
						  drawAgeChart(analyse_type,parseInt(pollId));
						  drawOthersChart(analyse_type,parseInt(pollId));
						  drawLocationChart(analyse_type,parseInt(pollId));
						}
					}
				});  

				$("#advanced-content").on("change","select.advancedanalyseSelect",function(){
			    	var elemId = $(this)[0].id;
					var pollId = elemId.split("---")[1];
					// console.log(elemId);
					// console.log(pollId);
					var isMatch = /^advancedanalyse-*/.test(elemId);
					// console.log(isMatch);
					var analyse_type = "advanced-";
					if(isMatch)
						analyse_type = "advancedanalyse-";
					var analysisDivId = '#'+analyse_type+'analyse---'+pollId+"Div";
					// console.log(analysisDivId);
					var common_elem_id_str = "#advancedanalyse---"+pollId+"---";
					var selectedChoice_age = $(common_elem_id_str+"Age").val();
					var selectedChoice_gender = $(common_elem_id_str+"Gender").val();
					var selectedChoice_prof = $(common_elem_id_str+"Profession").val();
					var selectedChoice_country = $(common_elem_id_str+"Country").val();
					var selectedChoice_state = $(common_elem_id_str+"State").val();
					// console.log(selectedChoice_age,selectedChoice_gender,selectedChoice_prof,selectedChoice_country,selectedChoice_state);
					drawPollsChart(analyse_type,parseInt(pollId),selectedChoice_age,selectedChoice_gender,selectedChoice_prof,selectedChoice_country,selectedChoice_state);
				});

				$("#advanced-content").on("change","select.advancedanalyseSelectCountry",function(){
			    	var elemId = $(this)[0].id;
					var pollId = elemId.split("---")[1];
					// console.log(elemId);
					// console.log(pollId);
					var common_elem_id_str = "#advancedanalyse---"+pollId+"---";
					var selectedChoice_country= $(common_elem_id_str+"Country").val();
					populateState(common_elem_id_str+"State",selectedChoice_country);
				});
			});
			function drawPollsChart(analyse_type,pollId,age,gender,profession,location,state) {
				// console.log(analyse_type,pollId,age,gender,profession,location);
				var pollsData = [];
				var pollsColors = ["#F7464A","#46BFBD","#66FF33","#FF6600"];
				var colCount = 0;
				var advanced_analyse = true;
				var advanced_analyse_dic = {};
				if(typeof age == 'undefined' && typeof gender == 'undefined' && typeof profession == 'undefined' && typeof location == 'undefined' && typeof state == 'undefined'){
					advanced_analyse = false;
				}
				else if((typeof age != 'undefined' && age == "nochoice") && (typeof gender != 'undefined' && gender == "nochoice") && (typeof profession != 'undefined' && profession == "nochoice") && (typeof location != 'undefined' && location == "nochoice") && (typeof state != 'undefined' && state == "nochoice")){
					advanced_analyse = false;
				} 
				if(advanced_analyse){
					$.ajax({
				        url: "/advanced_analyse",
				        type: 'POST',
				        data: { question: pollId,
				        		age: age,
				        		gender: gender,
				        		profession: profession,
				        		country: location,
				        		state: state,
				        		csrfmiddlewaretoken: "{{ csrf_token }}"
				        	},
				        async: false,
				        cache: false,
				        timeout: 30000,
				        error: function(){
				            return true;
				        },
				        success: function(msg){
				        	console.log(msg);
				        	advanced_analyse_dic=msg;
				        }
				    });
				}
				pollsData.push(['Element', 'Votes', { role: 'style' }, { role: 'annotation' }]);
				{% for questions in polls %}
				   {% with questions.poll as question %}
				   		if(pollId === {{ question.id }}){
							{% for choice in question.choice_set.all %}
								var inData = [];
								var choice_text = "";
								choice_text = 'Choice{{ forloop.counter }}';
								inData.push(choice_text);
								if(!advanced_analyse){
									inData.push({{ choice.vote_set.count }});
								} else{
									// console.log("iterate data from ajax");
									inData.push(advanced_analyse_dic[choice_text]);
								}
								inData.push(pollsColors[colCount++]);
								var percent = 0;
								if(!advanced_analyse){
									if({{ question.voted_set.count }} > 0)
										percent = Math.round(({{ choice.vote_set.count }}/{{ question.voted_set.count }})*100);
								} else{
									if(advanced_analyse_dic['total_votes'] > 0)
										percent = Math.round((advanced_analyse_dic[choice_text]/advanced_analyse_dic['total_votes'])*100);
								}
								inData.push(percent+"%");
								//console.log(inData);
								pollsData.push(inData);
							{% endfor %}
						}
					{% endwith %}
			  	{% endfor %}
				var data = google.visualization.arrayToDataTable(pollsData);
				var options = {
			          chartArea: {left:80,width: '60%'},
			          fontSize:14,
			          bars: {
			            groupWidth: 100
			          },
			          annotations:{
			          	textStyle: {
					      opacity: 0         // The transparency of the text.
					    }	        
			          },
			          hAxis: {
			            title: '',
			            minValue: 0,
			            gridlines: {
			              color: 'transparent'
			              },
			            textPosition: 'none',
			            baselineColor: 'transparent'
			          },
			          vAxis: {
			            title: '',
			            gridlines: {
			              color: 'transparent'
			              },
			          },
			          legend:{
			              position:'none'
			          },
			           animation:{
			              startup:true,
			              duration: 3000,
			              easing: 'inAndOut',
			         },
			        };

			        var chart = new google.visualization.BarChart(document.getElementById(analyse_type+'pollsChart---'+pollId));
			        chart.draw(data, options);
			        google.visualization.events.addListener(chart, 'animationfinish', displayAnnotation);   

			        function displayAnnotation(e){
			        data = google.visualization.arrayToDataTable(pollsData);
			        options = {
			          chartArea: {left:80,width: '60%'},
			          fontSize:14,
			          bars: {
			            groupWidth: 100
			          },
			          annotations:{
			          	textStyle: {
					      opacity: 1         // The transparency of the text.
					    }	        
			          },
			          hAxis: {
			            title: '',
			            minValue: 0,
			            gridlines: {
			              color: 'transparent'
			            },
			            textPosition: 'none',
			            baselineColor: 'transparent'
			          },
			          vAxis: {
			            title: '',
			            gridlines: {
			              color: 'transparent'
			              },
			          },
			          legend:{
			              position:'none'
			          },
			           animation:{
			              startup:true,
			              duration: 1,
			              easing: 'inAndOut',
			         },
			        };

			        chart.draw(data,options);
			    }
			}

			function drawGenderChart(analyse_type,pollId,choiceId) {
			  var genderData = [['Gender', 'Votes']];
			  var m = 0;
			  var f = 0;
			  var d = 0;
			  console.log(choiceId);
			  {% for questions in polls %}
			   {% with questions.poll as question %}
			  		if(pollId === {{ question.id }}){
			  			if(typeof choiceId != 'undefined' ){
			  				{% for choice in question.choice_set.all %}
			  				console.log({{ choice.id }},choiceId, typeof {{ choice.id }}, typeof choiceId);
			  				if ({{ choice.id }} == choiceId ){
			  				 	console.log("{{ choice.id }}");
							  	{% for vote in choice.vote_set.all %}
							  		console.log("-------------",{{ vote.choice_id }});
							  		{% if vote.user.extendeduser.gender == "M" %}
								  		m++;
								  	{% elif vote.user.extendeduser.gender == "F" %}
								  		f++;
								  	{% else %}
								  		d++;
								  	{% endif %}
							  	{% endfor %}
							 }
							{% endfor %}
			  			}
			  			else{
						  {% for voted in question.voted_set.all %}
						  	{% if voted.user.extendeduser.gender == "M" %}
						  		m++;
						  	{% elif voted.user.extendeduser.gender == "F" %}
						  		f++;
						  	{% else %}
						  		d++;
						  	{% endif %}
						  {% endfor %}
						}
					}
				{% endwith %}
			  {% endfor %}
			  if(m>0)
			  	genderData.push(['Male',m]);
			  if(f>0)
			  	genderData.push(['Female',f]);
			  if(d>0)
			  	genderData.push(['Not Disclosed',d])
			  console.log(genderData);
			  var data = google.visualization.arrayToDataTable(genderData);
			  var options = {
			    pieHole: 0.4,
			    legend:'bottom'
			  };
			  var chart = new google.visualization.PieChart(document.getElementById(analyse_type+'genderChart---'+pollId));
			  chart.draw(data, options);
			}

			function drawAgeChart(analyse_type,pollId,choiceId) {
			  var ageData = [['Age Group', 'Votes']];
			  var under_19 = 0;
			  var bet_20_25 = 0;
			  var bet_26_30 = 0;
			  var bet_31_35 = 0;
			  var bet_36_50 = 0;
			  var over_50 = 0;
			  {% for questions in polls %}
			  	{% with questions.poll as question %}
			  		if(pollId === {{ question.id }}){
			  			if(typeof choiceId != 'undefined' ){
			  				{% for choice in question.choice_set.all %}
			  					console.log({{ choice.id }},choiceId, typeof {{ choice.id }}, typeof choiceId);
			  					if ({{ choice.id }} == choiceId ){
				  				 	console.log("----------{{ choice.id }}");
								  	{% for vote in choice.vote_set.all %}
									  		{% if vote.user.extendeduser.calculate_age > 50 %}
										  		over_50++;
										  	{% elif vote.user.extendeduser.calculate_age > 35 %}
										  		bet_36_50++;
										  	{% elif vote.user.extendeduser.calculate_age > 30 %}
										  		bet_31_35++;
										  	{% elif vote.user.extendeduser.calculate_age > 25 %}
										  		bet_26_30++;
										  	{% elif vote.user.extendeduser.calculate_age > 19 %}
										  		bet_20_25++;
											{% elif vote.user.extendeduser.calculate_age > 0 %}
										  		under_19++;
											{% else %}
										  		console.log("Age wrong");
										  	{% endif %}
									{% endfor %}
								}
							{% endfor %}
						}
			  			else{
						  {% for voted in question.voted_set.all %}
							{% if voted.user.extendeduser.calculate_age > 50 %}
						  		over_50++;
						  	{% elif voted.user.extendeduser.calculate_age > 35 %}
						  		bet_36_50++;
						  	{% elif voted.user.extendeduser.calculate_age > 30 %}
						  		bet_31_35++;
						  	{% elif voted.user.extendeduser.calculate_age > 25 %}
						  		bet_26_30++;
						  	{% elif voted.user.extendeduser.calculate_age > 19 %}
						  		bet_20_25++;
							{% elif voted.user.extendeduser.calculate_age > 0 %}
						  		under_19++;
							{% else %}
						  		console.log("Age wrong");
						  	{% endif %}
						  {% endfor %}
						}
					}
				{% endwith %}
			  {% endfor %}
			  if(under_19 > 0)
			  	ageData.push(['Upto 19',under_19]);
			  if(bet_20_25 > 0)
			  	ageData.push(['20-25',bet_20_25]);
			  if(bet_26_30 > 0)
			  	ageData.push(['26-30',bet_26_30]);
			  if(bet_31_35 > 0)
			  	ageData.push(['31-35',bet_31_35]);
			  if(bet_36_50 > 0)
			  	ageData.push(['36-50',bet_36_50]);
			  if(over_50 > 0)
			  	ageData.push(['50+',over_50]);
			  var data = google.visualization.arrayToDataTable(ageData);
			  var options = {
			    pieHole: 0.4,
			    legend:'bottom'
			  };
			  var chart = new google.visualization.PieChart(document.getElementById(analyse_type+'ageChart---'+pollId));
			  chart.draw(data, options);
			}

			function drawOthersChart(analyse_type,pollId,choiceId) {
				var profDict = {};
				var profData = [['Profession','Votes']];
				{% for questions in polls %}
				  {% with questions.poll as question %}
			  		if(pollId === {{ question.id }}){
			  			if(typeof choiceId != 'undefined' ){
			  				{% for choice in question.choice_set.all %}
			  					console.log({{ choice.id }},choiceId, typeof {{ choice.id }}, typeof choiceId);
			  					if ({{ choice.id }} == choiceId ){
				  				 	console.log("{{ choice.id }}");
								  	{% for vote in choice.vote_set.all %}
								  		{% if vote.user.extendeduser.profession %}
											var prof = "{{ vote.user.extendeduser.profession }}";
											if(prof in profDict)
												profDict[prof] = profDict[prof]+1;
											else
												profDict[prof] = 1;
										{% endif %}
									{% endfor %}
								}
							{% endfor %}
			  			}
			  			else{
							{% for voted in question.voted_set.all %}
								{% if voted.user.extendeduser.profession %}
									var prof = "{{ voted.user.extendeduser.profession }}";
									if(prof in profDict)
										profDict[prof] = profDict[prof]+1;
									else
										profDict[prof] = 1;
								{% endif %}
							{% endfor %}
						}
					}
				  {% endwith %}
				{% endfor %}
				for(prof in profDict)
					profData.push([prof,profDict[prof]]);
			  var data = google.visualization.arrayToDataTable(profData);
			  var options = {
			    pieHole: 0.4,
			    legend:'bottom'
			  };
			  var chart = new google.visualization.PieChart(document.getElementById(analyse_type+'othersChart---'+pollId));
			  chart.draw(data, options);
			}
			
			function drawLocationChart(analyse_type,pollId,choiceId) {
			    // $('#mapBackButton').removeClass('back');
				var conData = [['Country', 'Votes']];
				var conDict = {};
				{% for questions in polls %}
				  {% with questions.poll as question %}
			  		if(pollId === {{ question.id }}){
			  			if(typeof choiceId != 'undefined' ){
			  				{% for choice in question.choice_set.all %}
			  					console.log({{ choice.id }},choiceId, typeof {{ choice.id }}, typeof choiceId);
			  					if ({{ choice.id }} == choiceId ){
				  				 	console.log("{{ choice.id }}");
								  	{% for vote in choice.vote_set.all %}
								  		{% if vote.user.extendeduser.country %}
											var country = "{{ vote.user.extendeduser.country }}";
											if(country == 'United Kingdom' || country=='Scotland' || country=='Wales' || country=='Northern Ireland'){
												country = 'United Kingdom'
											}
											if(country in conDict)
												conDict[country] = conDict[country]+1;
											else
												conDict[country] = 1;
										{% endif %}
									{% endfor %}
								}
							{% endfor %}
			  			}
			  			else{
							{% for voted in question.voted_set.all %}
								{% if voted.user.extendeduser.country %}
									var country = "{{ voted.user.extendeduser.country }}";
									if(country == 'United Kingdom' || country=='Scotland' || country=='Wales' || country=='Northern Ireland'){
										country = 'United Kingdom'
									}
									if(country in conDict)
										conDict[country] = conDict[country]+1;
									else
										conDict[country] = 1;
								{% endif %}
							{% endfor %}
						}
					}
				  {% endwith %}
				{% endfor %}
				for(con in conDict){
					conData.push([con,conDict[con]]);
				}
			    var data = google.visualization.arrayToDataTable(conData);
			    var options = {};
			    var chart = new google.visualization.GeoChart(document.getElementById(analyse_type+'locationChart---'+pollId));
			    chart.draw(data, options);
			    google.visualization.events.addListener(chart, 'regionClick', function(e){
			    	$("#"+analyse_type+"mapBackButton").css("display", "inline-block");
					// $('#mapBackButton').addClass("back");
					drawStateMap(analyse_type,e.region,pollId);
			    });
			}
			
			var regionDict = {
				"IN":"India","AZ":"Azerbaijan","US":"USA","PK":"Pakistan","GB":"United Kingdom","AU":"Australia","CA":"Canada","PH":"Philippines","AQ":"Antartica","BB":"Barbados","DE":"Germany","SJ":"Svalbard","AF":"Afghanistan","DZ":"Algeria","AL":"Albania","AS":"American Samoa","AO":"Angola","AI":"Anguilla","AG":"Antigua and Barbuda","AR":"Argentina","AM":"Armenia","AW":"Aruba","AT":"Austria","AZ":"Azerbaijan","BS":"Bahamas","BH":"Bahrain","BD":"Bangladesh","BB":"Barbados","BY":"Belarus","BE":"Belgium","BZ":"Belize","BJ":"Benin","BR":"Brazil","BM":"Bermuda","BT":"Bhutan","BO":"Bolivia","BA":"Bosnia and Herzegovina","CN":"China","DE":"Germany","DK":"Denmark","NL":"Netherlands","PK":"Pakistan","ZW":"Zimbabwe","ZM":"Zambia","ZA":"South Africa","CH":"Switzerland","TH":"Thailand","SG":"Singapore","SE":"Sweden","TR":"Turkey","QA":"Qatar","RE":"Reunion","RO":"Romania","SA":"Saudi Arabia","RW":"Rwanda","JP":"Japan","KE":"Kenya","NO":"Norway","NP":"Nepal","PL":"Poland","NZ":"New Zealand","GB-SCT":"Scotland","EG":"Egypt"
			}

			var englandDict = ["Buckinghamshire","Cambridgeshire","Cumbria","Derbyshire","Devon","Dorset","East Sussex","Essex","Gloucestershire",
				"Hampshire","Hertfordshire","Kent","Lancashire","Leicestershire","Lincolnshire","Norfolk","North Yorkshire","Northamptonshire",
				"Nottinghamshire","Oxfordshire","Somerset","Staffordshire","Suffolk","Surrey","Warwickshire","West Sussex","Worcestershire","London, City of","Barking and Dagenham","Barnet","Bexley","Brent","Bromley","Camden","Croydon","Ealing","Enfield","Greenwich","Hackney","Hammersmith and Fulham","Haringey","Harrow","Havering","Hillingdon","Hounslow","Islington","Kensington and Chelsea","Kingston upon Thames","Lambeth","Lewisham","Merton","Newham","Redbridge","Richmond upon Thames","Southwark","Sutton","Tower Hamlets","Waltham Forest","Wandsworth","Westminster","Barnsley","Birmingham","Bolton","Bradford","Bury","Calderdale","Coventry","Doncaster","Dudley","Gateshead","Kirklees","Knowsley","Leeds","Liverpool","Manchester","Newcastle upon Tyne","North Tyneside","Oldham","Rochdale","Rotherham","St. Helens","Salford","Sandwell","Sefton","Sheffield","Solihull","South Tyneside","Stockport","Sunderland","Tameside","Trafford","Wakefield","Walsall","Wigan","Wirral","Wolverhampton","Bath and North East Somerset","Bedford","Blackburn with Darwen","Blackpool","Bournemouth","Bracknell Forest","Brighton and Hove","Bristol, City of","Central Bedfordshire","Cheshire East","Cheshire West and Chester","Cornwall","Darlington","Derby","Durham","East Riding of Yorkshire","Halton","Hartlepool","Herefordshire","Isle of Wight","Isles of Scilly","Kingston upon Hull","Leicester","Luton","Medway","Middlesbrough","Milton Keynes","North East Lincolnshire","North Lincolnshire","North Somerset","Northumberland","Nottingham","Peterborough","Plymouth","Poole","Portsmouth","Reading","Redcar and Cleveland","Rutland","Shropshire","Slough","South Gloucestershire","Southampton","Southend-on-Sea","Stockton-on-Tees","Stoke-on-Trent","Swindon","Telford and Wrekin","Thurrock","Torbay","Warrington","West Berkshire","Wiltshire","Windsor and Maidenhead","Wokingham","York"];

			var nothernIreLand = ['Antrim','Ards','Armagh','Ballymena','Ballymoney','Banbridge','Belfast','Carrickfergus','Castlereagh','Coleraine','Cookstown','Craigavon','Derry','Down','Dungannon and South Tyrone','Fermanagh','Larne','Limavady','Lisburn','Magherafelt','Moyle','Newry and Mourne District','Newtownabbey','North Down','Omagh','Strabane'];

			var scotland = ["Aberdeen City","Aberdeenshire","Angus","Argyll and Bute","Clackmannanshire","Dumfries and Galloway","Dundee City","East Ayrshire","East Dunbartonshire","East Lothian","East Renfrewshire","Edinburgh, City of","Eilean Siar","Falkirk","Fife","Glasgow City","Highland","Inverclyde","Midlothian","Moray","North Ayrshire","North Lanarkshire","Orkney Islands","Perth and Kinross","Renfrewshire","Scottish Borders, The","Shetland Islands","South Ayrshire","South Lanarkshire","Stirling","West Dunbartonshire","West Lothian"];

			var wales = ["Blaenau Gwent","Bridgend","Caerphilly","Cardiff","Carmarthenshire","Ceredigion","Conwy","Denbighshire","Flintshire","Gwynedd","Isle of Anglesey","Merthyr Tydfil","Monmouthshire","Neath Port Talbot","Newport","Pembrokeshire","Powys","Rhondda, Cynon, Taff","Swansea","Torfaen","Wrexham","Vale of Glamorgan, The"];
				
			function drawStateMap(analyse_type,region,pollId,choiceId){
				var options = {
			      region: region,
			      displayMode: 'regions',
			      resolution: 'provinces',
			      datalessRegionColor: '#666',
			      colorAxis: {colors: ['#FF9900', '#FFFFFF', '#00CC00']},
			      backgroundColor: '#81d4fa',
			      domain: 'IN'
			  };
				var stateContry = regionDict[region];
				var stateData = [['State', 'Votes']];
				var stateDict = {};
				{% for questions in polls %}
				  {% with questions.poll as question %}
			  		if(pollId === {{ question.id }}){
			  			if(typeof choiceId != 'undefined' ){
			  				{% for choice in question.choice_set.all %}
			  				console.log({{ choice.id }},choiceId, typeof {{ choice.id }}, typeof choiceId);
			  				if ({{ choice.id }} == choiceId ){
			  				 console.log("{{ choice.id }}");
							  	{% for vote in choice.vote_set.all %}
									{% if vote.user.extendeduser.country %}
										var country = "{{ vote.user.extendeduser.country }}";
										if(country=='Scotland' || country=='Wales' || country=='Northern Ireland'){
												country = 'United Kingdom'
										}
										if(country == stateContry){
											var state = "{{ voted.user.extendeduser.state }}";
											if(country == 'United Kingdom')
											{
												console.log(state);
												if(englandDict.indexOf(state) > -1){
													stateDict['England'] = stateDict['England']||0 + 1;
												} else if(nothernIreLand.indexOf(state) > -1) {
													stateDict['Northern Ireland'] = stateDict['Northern Ireland']||0 + 1;
												} else if(scotland.indexOf(state) > -1) {
													stateDict['Scotland'] = stateDict['Scotland']||0 + 1;
												} else if(wales.indexOf(state) > -1) {
													stateDict['Wales'] = stateDict['Wales']||0 + 1;
												} else {
													stateDict[state] = 1;
												}
											} 
											else 
											{
												if(state in stateDict)
													stateDict[state] = stateDict[state]+1;
												else
													stateDict[state] = 1;
											}
										}
									{% endif %}
								{% endfor %}
							 }
							{% endfor %}
			  			}
			  			else{
							{% for voted in question.voted_set.all %}
								{% if voted.user.extendeduser.country %}
									var country = "{{ voted.user.extendeduser.country }}";
									if(country=='Scotland' || country=='Wales' || country=='Northern Ireland'){
											country = 'United Kingdom'
									}
									if(country == stateContry){
										var state = "{{ voted.user.extendeduser.state }}";
										if(country == 'United Kingdom')
										{
											console.log(state);
											if(englandDict.indexOf(state) > -1){
												stateDict['England'] = stateDict['England']||0 + 1;
											} else if(nothernIreLand.indexOf(state) > -1) {
												stateDict['Northern Ireland'] = stateDict['Northern Ireland']||0 + 1;
											} else if(scotland.indexOf(state) > -1) {
												stateDict['Scotland'] = stateDict['Scotland']||0 + 1;
											} else if(wales.indexOf(state) > -1) {
												stateDict['Wales'] = stateDict['Wales']||0 + 1;
											} else {
												stateDict[state] = 1;
											}
										} 
										else 
										{
											if(state in stateDict)
												stateDict[state] = stateDict[state]+1;
											else
												stateDict[state] = 1;
										}
									}
								{% endif %}
							{% endfor %}
						}
					}
				  {% endwith %}
				{% endfor %}
				for(state in stateDict){
					stateData.push([state,stateDict[state]]);
				}
				console.log(stateData)
				var data = google.visualization.arrayToDataTable(stateData);
				var chart = new google.visualization.GeoChart(document.getElementById(analyse_type+'locationChart---'+pollId));
				chart.draw(data, options);
			}
			    
			function back(analyse_type,pollId,choiceId){  
				$("#"+analyse_type+"mapBackButton").css("display", "none");  
			    drawLocationChart(analyse_type,pollId,choiceId);
			}
		</script>
	</section>
{% endblock %}
