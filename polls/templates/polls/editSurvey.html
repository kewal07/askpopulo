{% extends "polls/common.html" %}
	{% load static %}
	{% block extra_css %}
		<link rel="stylesheet" type="text/css" href="{% static 'polls/css/jquery-ui.css' %}" />
		<link rel="stylesheet" type="text/css" href="{% static 'login/css/company_admin.css' %}" />
		<link rel="stylesheet" type="text/css" href="{% static 'polls/css/createPoll.css' %}" />
		<link rel="stylesheet" type="text/css" href="{% static 'polls/css/edit_survey.css' %}" />
	{% endblock %}
	{% block extra_js %}
		<script src="{% static 'js/jquery.js' %}" ></script>
		<script src="{% static 'js/jquery-ui.js' %}" ></script>
		<script src="{% static 'js/jquery.autocomplete.multiselect.js' %}" ></script>
	{% endblock %}
	{% block content %}
		<section id="createPoll">
			<div class="createPoll">
				<div class="createPollContent">
				<form id="createPollForm" class="createPollContentForm autocomplete-me" method="POST" action="{% url 'polls:polls_create' %}?qid={{ question.id }}"  enctype="multipart/form-data">
					{% csrf_token %}
					<p class="form-p">
						<label class="required" for="surveyName">Name</label>
						<input type="text" id ="surveyName" name="surveyName" placeholder="Survey Name" value="{{ survey.survey_name }}"maxlength="64"></input>
					</p>
					<p class="form-p">
						<label class="required" for="surveyDescription">Description</label>
						<textarea id ="surveyDescription" name="surveyDescription" placeholder="Description">{{ survey.description }}</textarea>
					</p>
					<p>
						<label for="qExpiry">Expires On</label>
						<div class="newDateForm">
							<!-- <input id="qExpiry" type="date" name="qExpiry" value="{{ expiry_date }}"> -->
							<span id="oldExpiryTimespan">{{ survey.expiry }} </span>
							{% if survey.expiry %}
								<i style="cursor:pointer" id="clearOldExpiryTimefa" class="fa fa-times-circle-o"></i>
							{% endif %}
							<input id="oldExpiryTimeinput" type="hidden" name="oldExpiryTime" value="{{ survey.expiry }}" />
							<select id="qExpiry_month" name="qExpiry_month" selected="{{ qExpiry_month }}">
								<option value="0">Month</option>
								<option value="1">January</option>
								<option value="2">February</option>
								<option value="3">March</option>
								<option value="4">April</option>
								<option value="5">May</option>
								<option value="6">June</option>
								<option value="7">July</option>
								<option value="8">August</option>
								<option value="9">September</option>
								<option value="10">October</option>
								<option value="11">November</option>
								<option value="12">December</option>
							</select>
							<select id="qExpiry_day" name="qExpiry_day" selected="{{ qExpiry_day }}">
								<option value="0">Day</option>
								<option value="1">1</option>
								<option value="2">2</option>
								<option value="3">3</option>
								<option value="4">4</option>
								<option value="5">5</option>
								<option value="6">6</option>
								<option value="7">7</option>
								<option value="8">8</option>
								<option value="9">9</option>
								<option value="10">10</option>
								<option value="11">11</option>
								<option value="12">12</option>
								<option value="13">13</option>
								<option value="14">14</option>
								<option value="15">15</option>
								<option value="16">16</option>
								<option value="17">17</option>
								<option value="18">18</option>
								<option value="19">19</option>
								<option value="20">20</option>
								<option value="21">21</option>
								<option value="22">22</option>
								<option value="23">23</option>
								<option value="24">24</option>
								<option value="25">25</option>
								<option value="26">26</option>
								<option value="27">27</option>
								<option value="28">28</option>
								<option value="29">29</option>
								<option value="30">30</option>
								<option value="31">31</option>
							</select>
							<select id="qExpiry_year" name="qExpiry_year" selected="{{ qExpiry_year }}">
								<option value="0">Year</option>
								<option value="2015">2015</option>
								<option value="2016">2016</option>
								<option value="2017">2017</option>
								<option value="2018">2018</option>
								<option value="2019">2019</option>
								<option value="2020">2020</option>
								<option value="2021">2021</option>
								<option value="2022">2022</option>
								<option value="2023">2023</option>
								<option value="2024">2024</option>
								<option value="2025">2025</option>
								<option value="2026">2026</option>
								<option value="2027">2027</option>
								<option value="2028">2028</option>
								<option value="2029">2029</option>
								<option value="2030">2030</option>
								<option value="2031">2031</option>
								<option value="2032">2032</option>
								<option value="2033">2033</option>
								<option value="2034">2034</option>
								<option value="2035">2035</option>
								<option value="2036">2036</option>
								<option value="2037">2037</option>
								<option value="2038">2038</option>
								<option value="2039">2039</option>
								<option value="2040">2040</option>
								<option value="2041">2041</option>
								<option value="2042">2042</option>
								<option value="2043">2043</option>
								<option value="2044">2044</option>
								<option value="2045">2045</option>
								<option value="2046">2046</option>
								<option value="2047">2047</option>
								<option value="2048">2048</option>
								<option value="2049">2049</option>
								<option value="2050">2050</option>
								<option value="2051">2051</option>
								<option value="2052">2052</option>
								<option value="2053">2053</option>
								<option value="2054">2054</option>
								<option value="2055">2055</option>
								<option value="2056">2056</option>
								<option value="2057">2057</option>
								<option value="2058">2058</option>
								<option value="2059">2059</option>
								<option value="2060">2060</option>
								<option value="2061">2061</option>
								<option value="2062">2062</option>
								<option value="2063">2063</option>
								<option value="2064">2064</option>
								<option value="2065">2065</option>
								<option value="2066">2066</option>
								<option value="2067">2067</option>
								<option value="2068">2068</option>
								<option value="2069">2069</option>
								<option value="2070">2070</option>
								<option value="2071">2071</option>
								<option value="2072">2072</option>
								<option value="2073">2073</option>
								<option value="2074">2074</option>
								<option value="2075">2075</option>
								<option value="2076">2076</option>
								<option value="2077">2077</option>
								<option value="2078">2078</option>
								<option value="2079">2079</option>
								<option value="2080">2080</option>
								<option value="2081">2081</option>
								<option value="2082">2082</option>
								<option value="2083">2083</option>
								<option value="2084">2084</option>
								<option value="2085">2085</option>
								<option value="2086">2086</option>
								<option value="2087">2087</option>
								<option value="2088">2088</option>
								<option value="2089">2089</option>
								<option value="2090">2090</option>
								<option value="2091">2091</option>
								<option value="2092">2092</option>
								<option value="2093">2093</option>
								<option value="2094">2094</option>
								<option value="2095">2095</option>
								<option value="2096">2096</option>
								<option value="2097">2097</option>
								<option value="2098">2098</option>
								<option value="2099">2099</option>
								<option value="2100">2100</option>
								<option value="2101">2101</option>
								<option value="2102">2102</option>
								<option value="2103">2103</option>
								<option value="2104">2104</option>
								<option value="2105">2105</option>
								<option value="2106">2106</option>
								<option value="2107">2107</option>
								<option value="2108">2108</option>
								<option value="2109">2109</option>
								<option value="2110">2110</option>
								<option value="2111">2111</option>
								<option value="2112">2112</option>
								<option value="2113">2113</option>
								<option value="2114">2114</option>
								<option value="2115">2115</option>
							</select>
							<select name="qExpiry_hr" id="qExpiry_hr" selected="{{ qExpiry_hr }}">
								<option value="0">hr</option>
								<option value="1">1</option>
								<option value="2">2</option>
								<option value="3">3</option>
								<option value="4">4</option>
								<option value="5">5</option>
								<option value="6">6</option>
								<option value="7">7</option>
								<option value="8">8</option>
								<option value="9">9</option>
								<option value="10">10</option>
								<option value="11">11</option>
								<option value="12">12</option>
							</select>
							<select name="qExpiry_min" id="qExpiry_min" selected="{{ qExpiry_min }}">
								<option value="-1">min</option>
								<option value="0">0</option>
								<option value="1">1</option>
								<option value="2">2</option>
								<option value="3">3</option>
								<option value="4">4</option>
								<option value="5">5</option>
								<option value="6">6</option>
								<option value="7">7</option>
								<option value="8">8</option>
								<option value="9">9</option>
								<option value="10">10</option>
								<option value="11">11</option>
								<option value="12">12</option>
								<option value="13">13</option>
								<option value="14">14</option>
								<option value="15">15</option>
								<option value="16">16</option>
								<option value="17">17</option>
								<option value="18">18</option>
								<option value="19">19</option>
								<option value="20">20</option>
								<option value="21">21</option>
								<option value="22">22</option>
								<option value="23">23</option>
								<option value="24">24</option>
								<option value="25">25</option>
								<option value="26">26</option>
								<option value="27">27</option>
								<option value="28">28</option>
								<option value="29">29</option>
								<option value="30">30</option>
								<option value="31">31</option>
								<option value="32">32</option>
								<option value="33">33</option>
								<option value="34">34</option>
								<option value="35">35</option>
								<option value="36">36</option>
								<option value="37">37</option>
								<option value="38">38</option>
								<option value="39">39</option>
								<option value="40">40</option>
								<option value="41">41</option>
								<option value="42">42</option>
								<option value="43">43</option>
								<option value="44">44</option>
								<option value="45">45</option>
								<option value="46">46</option>
								<option value="47">47</option>
								<option value="48">48</option>
								<option value="49">49</option>
								<option value="50">50</option>
								<option value="51">51</option>
								<option value="52">52</option>
								<option value="53">53</option>
								<option value="54">54</option>
								<option value="55">55</option>
								<option value="56">56</option>
								<option value="57">57</option>
								<option value="58">58</option>
								<option value="59">59</option>
							</select>
							<select name="qExpiry_ap" id="qExpiry_ap" selected="{{ qExpiry_ap }}">
								<option value="AM">AM</option>
								<option value="PM">PM</option>
							</select>
						</div>
					</p>
					<p>
						<label for="categories">Category <i id="category_tooltip_fa" class="fa fa-info-circle"></i></label>
						<input id="categories" type="text" name="categories" >
						<input id="selectedCategories" type="hidden" name="selectedCategories" value="{{ survey_categories }}">
					</p>
					<p class="anonymous" style="margin-top:2rem">
						{% if surveyResultProtected %}
							<input id="protectResult" name="protectResult" type="checkbox" checked>
						{% else %}
							<input id="protectResult" name="protectResult" type="checkbox">
						{% endif %}
						<label for="protectResult">Protect Survey Result </label>
					</p>
					<div class="survey-questions">
						{% for question in polls %}
							<div class="survey-question-div" id="questionDiv{{ forloop.counter }}">
								<i id="remove-question{{ forloop.counter }}" class="fa fa-times-circle remove-question">Remove</i>
								<p>
									<label for="qText{{ forloop.counter }}">Question</label>
									<textarea id ="qText{{ forloop.counter }}" name="qText{{ forloop.counter }}" placeholder="Ask the people" maxlength="200">{{ question.poll.question_text }}</textarea>							
								</p>
								<p>
									<label for="qDesc{{ forloop.counter }}">Description</label>
									<textarea id ="qDesc{{ forloop.counter }}" name="qDesc{{ forloop.counter }}" placeholder="Description" maxlength="400">{{ question.poll.description }}</textarea>
								</p>
								<p class="anonymous">
									{% if question.poll.protectResult %}
										<input id="protectResult{{ forloop.counter }}" name="protectResult{{ forloop.counter }}" type="checkbox" checked>
									{% else %}
										<input id="protectResult{{ forloop.counter }}" name="protectResult{{ forloop.counter }}" type="checkbox">
									{% endif %}
									<label for="protectResult{{ forloop.counter }}">Protect Result </label>
								</p>
								<p class="form-p">
									<label for="qType{{ forloop.counter }}">Question Type</label>
									<select class="question-type-select" id="question-type-select{{ forloop.counter }}" name="qType{{ forloop.counter }}">
										<option value="text" {% if question.type == "text" %}selected{% endif %} >Text</option>
										<option value="radio" {% if question.type == "radio" %}selected{% endif %}>Single Select</option>
										<option value="checkbox" {% if question.type == "checkbox" %}selected{% endif %}>Multi Select</option>
									</select>
								</p>
								{% if question.type == "text" %}
								{% else %}
									<div id="question{{ forloop.counter }}choiceDiv">
										{% for choice in question.poll.choice_set.all %}
											<div id="questionDiv{{ forloop.parentloop.counter }}choice{{ forloop.counter }}Div">
											<p>
												<label for="questionDiv{{ forloop.parentloop.counter }}choice{{ forloop.counter }}"></label>
												<input id="questionDiv{{ forloop.parentloop.counter }}choice{{ forloop.counter }}" type="text" name="questionDiv{{ forloop.parentloop.counter }}choice{{ forloop.counter }}" placeholder="Enter Choice" value="{{ choice.choice_text }}" maxlength="200">
												{% if choice.choice_image %}
													<img class="choices choice_image" id="questionDiv{{ forloop.parentloop.counter }}imagechoice{{ forloop.counter }}" src="/media/choices/{{ choice.get_file_name }}" alt="{{ choice.choice_text }}" onmouseover='this.src="/static/polls/images/crossicon.png"' onmouseout='this.src="/media/choices/{{ choice.get_file_name }}"'>
													<input type="hidden" id="questionDiv{{ forloop.parentloop.counter }}imagetextchoice{{ forloop.counter }}" name="questionDiv{{ forloop.parentloop.counter }}imagechoice{{ forloop.counter }}" value="/media/choices/{{ choice.get_file_name }}---{{ choice.id }}" />
												{% endif %}
												<input id="questionDiv{{ forloop.parentloop.counter }}filechoice{{ forloop.counter }}" class="fileButtonClass" type="file" name="questionDiv{{ forloop.parentloop.counter }}choice{{ forloop.counter }}" accept="image/*">
												<i id="{{ forloop.parentloop.counter }}---{{ forloop.counter }}---{{ question.type }}" class="fa fa-times-circle remove-choice">Remove</i>
											</p>
											</div>
										{% endfor %}
										{% if question.poll.choice_set.all|length < 5 %}
											<i id="{{ forloop.counter }}---{{ question.type }}" class="fa fa-plus-circle add-choice">Add Another</i>
										{% else %}
											<i id="{{ forloop.counter }}---{{ question.type }}" class="fa fa-plus-circle add-choice" style="display:none">Add Another</i>
										{% endif %}
								</div>
							{% endif %}
							</div>
						{% endfor %}
					</div>
					<i class="fa fa-plus-circle add-q">Add Question</i>
					<p>
					{% if clone %}
						<input class="submit" type="submit" value="Clone" id="createPollSubmit"/>
					{% else %}
						<input class="submit" type="submit" value="Update" id="createPollSubmit"/>
					{% endif %}
					</p>
				</form>
				</div>
			</div>
			<div class="tooltip" id="category_tooltip">
				<span>Categories list:<br></span>
				{% for cat in data %}
					<span class="cat_title_tooltip">{{ cat }},    </span>
				{% endfor %}
			</div>
		</section>
		<script>
			var availableTags = []
			{% for categories in data %}
				availableTags.push("{{ categories.category_title }}");
			{% endfor %}
			//console.log(availableTags);
			$( "#categories" ).autocomplete({
				source: availableTags,
				multiselect: true,
				maxselection: 5,
				elemId: "selectedCategories"
			});
			var question_count = 0;
			var question_list = [];
			var choice_count = {};
			var choice_list = {};
			var protectedResultSurvey = false;
			function add_another_choice(question_count_select,selectedType){
				var question_choice_count = choice_count[question_count_select];
	  			choice_list[question_count_select].push(question_choice_count);
	  			var choice_elem_div = "question"+question_count_select+"choiceDiv";
	  			var question_div = "questionDiv"+question_count_select;
				var choice_elem_id = question_div+'choice'+question_choice_count;
				var choice_file_id = question_div+'choice'+question_choice_count+'file';
				// console.log(question_count_select,selectedType,question_div);
				var font_awesome_str = "";
				var choice_elem = "";
				if(selectedType === "radio"){
					font_awesome_str = "";
				} else if(selectedType === "checkbox"){
					font_awesome_str = "";
				}
				if(selectedType != "text"){
					choice_elem += '<div id="'+choice_elem_id+'Div"><p class"form-p">'+ font_awesome_str;
					choice_elem += '<label for="'+choice_elem_id+'"></label><input id="'+choice_elem_id;
					choice_elem += '" class="createPollText" type="text" name="'+choice_elem_id+'" placeholder="Enter Choice" maxlength="200">';
					choice_elem += '<input id="'+choice_file_id+'" class="fileButtonClass" type="file" name="'+choice_elem_id+'" accept="image/*">';
					choice_elem += '<i id="' +question_count_select+'---'+ question_choice_count+'---'+selectedType+ '" class="fa fa-plus-circle remove-choice">Remove</i></p></div>';
					// console.log($("#"+choice_elem_div).last());
					$("#"+choice_elem_div).append(choice_elem);
				}
				choice_count[question_count_select]+=1;
				
				/*For file browse */
					var invisible = $('<div/>').css({height:0,width:0,'overflow':'hidden','display':'inline-block'});
					var label = $('<div class="fileLabel"><img class="upImg" style="display:none;"><span id="upImgText">Upload Image</span></div>');
					// var upImg = $('<img id="upImg" width=>')
					var fileInput = $("#"+choice_file_id).after(label).wrap(invisible);
					// $("#"+choice_file_id).hide();

					fileInput.change(function(){
						// $('#upImgText').hide();
					    $this = $(this);
					    var fileVal = $this.val();
				    	var fileNameIndex = fileVal.lastIndexOf("\\") + 1;
				    	var fileName = fileVal.substr(fileNameIndex);
				    	if (this.files && this.files[0]) {
				            var reader = new FileReader();
				            
				            reader.onload = function (e) {
				                imgSrc = e.target.result;
								console.log($this.parent().children().first());
								// $(".upImg").attr('src', e.target.result);
								$this.parent().next().children().first().attr('src', e.target.result);
								// $(".upImg").show();
								$this.parent().next().children().first().show();
				            }
				            
				            reader.readAsDataURL(this.files[0]);
				        }
						// $("#upImgText").text(fileName);
						$this.parent().next().children().first().next().hide();
				    	$this.parent().parent().children().first().next().attr("placeholder", "Describe your image");
					})
				/* End of file browse*/
			}
			$(document).ready(function(){
				protectedResultSurvey = $("#protectResult").is(':checked');
				$(".fileButtonClass").click(function(){
					var elemId = $(this)[0].id;
					$("#"+elemId.replace("file","image")).hide();
					$("#"+elemId.replace("file","imagetext")).val("");
				});
				$(".choice_image").click(function(){
					var elemId = $(this)[0].id;
					$("#"+elemId.replace("image","image")).hide();
					$("#"+elemId.replace("image","imagetext")).val("");
				});
				{% for question in polls %}
					question_count += 1;
					question_list.push(question_count.toString());
					choice_count[question_count] = 0;
			  		choice_list[question_count] = [];
					{% for choice in question.poll.choice_set.all %}
						choice_count[question_count] += 1;
						choice_list[question_count].push(choice_count[question_count]);
					{% endfor %}
					choice_count[question_count] += 1;
				{% endfor %}
				question_count += 1
				console.log(question_count,question_list,choice_count,choice_list);

				$(".add-q").click(function(){
			  		choice_count[question_count] = 1;
			  		choice_list[question_count] = [];
			  		var question_count_str = question_count.toString();
			  		question_list.push(question_count_str);
			  		var question_elem = '<div class="survey-question-div" id="questionDiv'+question_count_str+'">';
			  		question_elem += '<i id="remove-question' +question_count_str+ '"class="fa fa-plus-circle remove-question">Remove</i><p class="form-p"><label class=" required" for="qText';
			  		question_elem += question_count_str;
			  		question_elem += '">Question</label><textarea id ="qText';
			  		question_elem += question_count_str;
			  		question_elem += '" name="qText';
			  		question_elem += question_count_str;
			  		question_elem += '" placeholder="Ask the people" maxlength="200"></textarea></p><p class="form-p"><label for="qDesc';
			  		question_elem += question_count_str;
			  		question_elem += '">Description</label><textarea id ="qDesc';
			  		question_elem += question_count_str;
			  		question_elem += '" name="qDesc';
			  		question_elem += question_count_str;
			  		question_elem += '" placeholder="Description" maxlength="400"></textarea></p>';
			  		if(protectedResultSurvey)
			  			question_elem += '<p class="anonymous"><input id="protectResult' +question_count_str+ '" name="protectResult' +question_count_str+ '" type="checkbox" checked><label for="protectResult' +question_count_str+ '">Protect Result </label></p>';
			  		else
			  			question_elem += '<p class="anonymous"><input id="protectResult' +question_count_str+ '" name="protectResult' +question_count_str+ '" type="checkbox"><label for="protectResult' +question_count_str+ '">Protect Result </label></p>';
			  		question_elem += '<p class="form-p"><label for="qType';
			  		question_elem += question_count_str;
			  		question_elem += '">Question Type</label><select class="question-type-select" id="question-type-select'+question_count_str+'" name="qType'+question_count_str+'"><option value="text">Text</option><option value="radio">Single Select</option><option value="checkbox">Multi Select</option></select></p>';
			  		question_elem += '</div>';
			  		// console.log(question_elem);
			  		$(".survey-questions").append(question_elem);
			  		question_count += 1;
			  	});

				$(".survey-questions").on("click",".remove-choice",function(){
					var elemId = $(this)[0].id;
					var question_count_select2 = elemId.split("---")[0];
					var question_choice_count2 = elemId.split("---")[1];
					var selectedType2 = elemId.split("---")[2];
					$("#questionDiv"+question_count_select2+"choice"+question_choice_count2+"Div").remove();
					choice_list[question_count_select2] = jQuery.grep(choice_list[question_count_select2], function(value) {
					  return value != question_choice_count2;
					})
					if(choice_list[question_count_select2].length < 5){
						if ($("#"+question_count_select2+'---'+selectedType2).length > 0) {
						    $("#"+question_count_select2+'---'+selectedType2).show();
						}
					}
					// choice_list[question_count_select2].remove(question_choice_count2);
				});

				$(".survey-questions").on("change",".question-type-select",function(){
		  			var select_elem_id = $(this)[0].id;
		  			var question_count_select = select_elem_id.replace("question-type-select","");
		  			choice_count[question_count_select] = 1;
		  			choice_list[question_count_select] = [];
		  			var question_choice_count = choice_count[question_count_select];
		  			var choice_elem_div = "question"+question_count_select+"choiceDiv";
		  			var question_div = "questionDiv"+question_count_select;
					$("#"+choice_elem_div).remove();
		  			// console.log($("#"+choice_elem_div));
		  			var selectedType = $("#"+select_elem_id+" option:selected").val();
					if(selectedType != "text"){
						var add_another_choice_elem = '<div id="'+choice_elem_div+'"></div>';
						$("#"+question_div).append(add_another_choice_elem);
						$("#"+choice_elem_div).append('<i id="' +question_count_select+'---'+selectedType + '" class="fa fa-plus-circle add-choice">Add Another</i>');
						add_another_choice(question_count_select,selectedType);
					}
				});

				$(".survey-questions").on("click",".add-choice",function(){
					var elemId = $(this)[0].id;
					var question_count_select1 = elemId.split("---")[0];
					var selectedType1 = elemId.split("---")[1];
					add_another_choice(question_count_select1,selectedType1);
					if(choice_list[question_count_select1].length >= 5){
						$("#"+question_count_select1+'---'+selectedType1).hide();
					}
				});

				$(".survey-questions").on("click",".remove-question",function(){
					var elemId = $(this)[0].id;
					var question_count_select3 = elemId.replace("remove-question","");
					$("#questionDiv"+question_count_select3).remove();
					question_list = jQuery.grep(question_list, function(value) {
					  return value != question_count_select3;
					})
					delete choice_list[question_count_select3];
				});

				$('.survey-questions').on("click",'.fileLabel',function(){
					$(this).prev().children().first().click();
				});
				
				$('.submit').bind('click', function()
				{
					// console.log("click called..........");
					var elemid = "#createPollForm";//$(this)[0].id
					// console.log($(elemid)); 
					var form_data = new FormData($(elemid)[0]);
					form_data.append('question_count', JSON.stringify(question_list));
					form_data.append('choice_count', JSON.stringify(choice_list));
					var create_survey_url = "/create_survey?sid={{ survey.id }}";
					{% if clone %}
						create_survey_url = "/create_survey";
					{% endif %}
					$(elemid).bind('submit', function()
					{
						//console.log("submit called....");
						$("#createPollSubmit").attr("disabled","disabled");
						{% if user.is_authenticated %}
						//console.log("call ajax");
							$.ajax(
							{
								type: 'POST',
								url:create_survey_url,
								data:form_data,
								processData: false,
								contentType: false,
								success:function(obj)
								{
									$(".errorlist").remove();
									console.log(obj);
									if(obj.hasOwnProperty("success"))
										$(location).attr('href',"/survey/"+obj['id']+"/"+obj['survey_slug']);
									else{
										for(var key in obj){
										    if (obj.hasOwnProperty(key)){
										    	if(key === "surveyError")
											        $(".createPollContent").children().first().prepend('<span class="errorlist errorlistSurvey error-survey"><br>'+obj[key]+'</span>');
											   	else{
											   		$("#"+key).parent().append('<span class="errorlist errorlistSurvey"><br>'+obj[key]+'</span>');
											   	}
										    }
										}
										$("#createPollSubmit").removeAttr('disabled');
									}
								}
							});
						{% else %}
							//url = "http://{{ request.META.HTTP_HOST }}"+'/vote/'+queid+'/'+queslug
							//console.log(vote_url);
							$(location).attr('href',"/");
						{% endif %}
						return false;
					});
				});

				$("#protectResult").click(function(){
					protectedResultSurvey = !protectedResultSurvey;
					var checked = false;
					if($("#protectResult").is(':checked'))
						checked = true;
					for(var i=1; i<question_count; i++){
						$("#protectResult"+i).prop( "checked", checked );
					}
				});

			});
		</script>
	{% endblock %}

