{% extends "polls/report_common.html" %}
{% load static %}
{% block meta_data_extra %}
	{% with survey.has_image as has_image %}
	{%if has_image %}
		<meta property="og:image" content="http://{{ request.META.HTTP_HOST }}/media/choices/{{ has_image }}"/>
		<meta property="og:image:width" content="325" /> 
		<meta property="og:image:height" content="325" />
	{% else %}
		<meta property="og:image" content="http://{{ request.META.HTTP_HOST }}/static/pollsLogoShareNew.png"/>
	{% endif %}
	{% endwith %}
	<meta property="og:url" content="https://{{ request.META.HTTP_HOST }}{{ request.path }}"/>
	<meta property="og:title" content="{{ survey.survey_name  }}"/>
	<meta property="og:description" content="{{ survey.description  }}" />
{% endblock %}
{% block extra_css %}
	<!-- <link rel="stylesheet" type="text/css" href="{% static 'polls/css/index.css' %}" /> -->
	<link rel="stylesheet" type="text/css" href="{% static 'login/css/company_admin.css' %}" />
{% endblock %}
{% block extra_js %}
	<script type="text/javascript" src="https://www.google.com/jsapi"></script>
	<script type="text/javascript">
		google.load("visualization", "1", {packages:["corechart"]});
		function drawPollsChartPDF(choice_data,elementId,total_votes) {
			var pollsData = [];
			var pollsColors = ["#F7464A","#46BFBD","#66FF33","#FF6600"];
			var colCount = 0;
			pollsData.push(['Element', 'Votes', { role: 'style' }, { role: 'annotation' }]);
			var choiceLength = Object.keys(choice_data).length;
			for(var i=1 ; i<=choiceLength; i++){
				var inData = [];
				inData.push("Choice"+i);
				inData.push(choice_data["choice"+i]);
				inData.push(pollsColors[colCount++]);
				var percent = 0;
				if(total_votes > 0)
					percent = Math.round((choice_data["choice"+i]/total_votes)*100);
				inData.push(percent+"%");
				pollsData.push(inData);
			}
			var data = google.visualization.arrayToDataTable(pollsData);
			var options = {
	          chartArea: {left:80,width: '650px'},
	          // fontSize:14,
	          bars: {
	            groupWidth: 10
	          },
	          annotations:{
	          	textStyle: {
			      opacity: 1       // The transparency of the text.
			    }	        
	          },
	          hAxis: {
	            title: '',
	            minValue: 0,
	            gridlines: {
	              color: 'transparent'
	              },
	            textPosition: 'none',
	            baselineColor: 'transparent'
	          },
	          vAxis: {
	            title: '',
	            gridlines: {
	              color: 'transparent'
	              },
	          },
	          legend:{
	              position:'none'
	          },
	        };

        	var chart = new google.visualization.BarChart(document.getElementById(elementId));
        	google.visualization.events.addListener(chart, 'ready', function () {
        		console.log(chart.getImageURI());
		      document.getElementById(elementId).innerHTML = '<img width="650px" height="200px" src="' + chart.getImageURI() + '">';
		    });
        	chart.draw(data, options);
		}
		function drawAgeChartPDF(age_dic,elementId) {
			var data = google.visualization.arrayToDataTable([
			  ['Task', 'Hours per Day'],
			  ['Upto 19',age_dic['under_19']],
			  ['19-25',age_dic['bet_20_25']],
			  ['26-30',age_dic['bet_26_30']],
			  ['31-35',age_dic['bet_31_35']],
			  ['36-50',age_dic['bet_36_50']],
			  ['50 Above',age_dic['over_50']]
			]);
			var options = {
			  // 'backgroundColor': 'transparent',
			  'width':325,
              // 'height':325
			};
			var chart = new google.visualization.PieChart(document.getElementById(elementId));
			google.visualization.events.addListener(chart, 'ready', function () {
        		console.log(chart.getImageURI());
		      	document.getElementById(elementId).innerHTML = '<img width="325px" src="' + chart.getImageURI() + '">';
		    });
		    chart.draw(data, options);
	  	}
	  	function drawGenderChartPDF(gender_dic,elementId) {
			var data = google.visualization.arrayToDataTable([
			  ['Task', 'Hours per Day'],
			  ['Male', gender_dic["M"]],
			  ['Female',gender_dic["F"]],
			  ['Not Say', gender_dic["D"]]
			]);
			var options = {
			  // 'backgroundColor': 'transparent',
			  'width':325,
              // 'height':325
			};
			var chart = new google.visualization.PieChart(document.getElementById(elementId));
			google.visualization.events.addListener(chart, 'ready', function () {
        		console.log(chart.getImageURI());
		      	document.getElementById(elementId).innerHTML = '<img width="325px" src="' + chart.getImageURI() + '">';
		    });
			chart.draw(data, options);
		}
		function drawProfessionChartPDF(prof_dic,elementId) {
			var profData = [['Profession','Votes']];
			for(prof in prof_dic)
				profData.push([prof,prof_dic[prof]]);
			var data = google.visualization.arrayToDataTable(profData);
			var options = {
			  // 'backgroundColor': 'transparent',
			  'width':325,
              // 'height':325
			};
			var chart = new google.visualization.PieChart(document.getElementById(elementId));
			google.visualization.events.addListener(chart, 'ready', function () {
        		console.log(chart.getImageURI());
		      	document.getElementById(elementId).innerHTML = '<img width="325px" src="' + chart.getImageURI() + '">';
		    });
			chart.draw(data, options);
		}
		function drawRegionsMapPDF(country_dic,elementId) {
			console.log(country_dic);
			var conData = [['Country', 'Votes']];
			for(con in country_dic){
				conData.push([con,country_dic[con]]);
			}
			var data = google.visualization.arrayToDataTable(conData);
			var options = {
				// 'backgroundColor': 'transparent'
			};
			var chart = new google.visualization.GeoChart(document.getElementById(elementId));
			google.visualization.events.addListener(chart, 'ready', function () {
        		console.log(chart.getImageURI());
		      	document.getElementById(elementId).innerHTML = '<img width="325px" src="' + chart.getImageURI() + '">';
		    });
			chart.draw(data, options);
		}
	</script>
{% endblock %}
{% block content %}
	
		<div class="pdf-pages" id="pdf-page1">
			<div class="survey-overview survey-overview-pdf">
				<h1 class="page-main-heading">Macro Analysis of the Survey</h1>
				<!-- <p> Total Number of polls : {{ survey_det.polls|length }} </p> -->
				<div class="table-container">
					<div class="table-component">
						<table>
							<thead>
								<tr>
									<th>Total Responses</th>
									<th>Completion Rate</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>{{ surveytotalResponses }}</td>
									<td>{{ incompleteResponses }}%</td>
								</tr>
							</tbody>
						</table>		
					</div>
				</div><!-- /container -->
				<div class="table-container">
					<div class="table-component">
						<table>
							<thead>
								<tr>
									<th class="question-table">Question ID</th>
									<th>Responses</th>
									<th>Most Voted</th>
									<th>Least Voted</th>
								</tr>
							</thead>
							<tbody>
								{% for poll in polls %}
									<tr>
										<th class="question-table-heading">Question{{ forloop.counter }} : {{ poll.question.question_text }}</th>
										<td> {{ poll.totalResponses }} votes</td>
										{% if poll.q_type != "text" %}
											<td> 
												{% for choice in poll.maxVotes %}
													{{ choice }} votes
												{% endfor %}
											</td>
											<td>
												{% for choice in poll.minVotes %}
													{{ choice }} votes
												{% endfor %}
											</td>
										{% else %}
											<td>NA</td>
											<td>NA</td>
										{% endif %}
									</tr>
								{% endfor %}
							</tbody>
						</table>		
					</div>
				</div><!-- /container -->
			</div>
		</div>

		<div class="pdf-pages" id="pdf-page2">
			<div class="survey-overview survey-overview-pdf">
				<h1 class="page-main-heading">Per Question Survey Analysis</h1>
				{% for poll in polls %}
				{% if poll.question.id == maxVotedQuestion %}
					{% for choice in poll.question.choice_set.all %}
						{% if choice.choice_image %}
							<figure>
								<img class="choiceImage choiceDetailImage" src="/media/choices/{{ choice.get_file_name }}" alt="{{ choice.choice_text }}">
								<figcaption class="choiceFigCaption">
									{% if choice.choice_text %}
										Choice{{ forloop.counter }} : {{ choice.choice_text }}
									{% else %}
										Choice{{ forloop.counter }}
									{% endif %}
								</figcaption>
							</figure>
						{% else %}
							Choice{{ forloop.counter }} : "{{ choice.choice_text }}"
							<br/>
						{% endif %}
					{% endfor %}
					<p class="data-heading-pdf">
						{{ poll.question.question_text }}
					</p>
					<div id="pollsChart-pdf" class="pollsChartPDF"></div>
					<div id="analysis-pdf">
						<div class="pdf-chart" id="genderchart"></div>
						<div class="pdf-chart" id="agechart"></div>
						<div class="pdf-chart" id="locationchart"></div>
						<div class="pdf-chart" id="professionchart"></div>
					</div>
					<script type="text/javascript">
						google.setOnLoadCallback(drawPollsChartPDF({{ poll.choice_graph|safe }},"pollsChart-pdf",{{ poll.total_choice_vote }}));
						google.setOnLoadCallback(drawAgeChartPDF({{ poll.age_graph|safe }},"agechart"));
						google.setOnLoadCallback(drawGenderChartPDF({{ poll.gender_graph|safe }},"genderchart"));
						google.setOnLoadCallback(drawProfessionChartPDF({{ poll.prof_graph|safe }},"professionchart"));
						google.setOnLoadCallback(drawRegionsMapPDF({{ poll.country_graph|safe }},"locationchart"));
					</script>
				{% endif %}
				{% endfor %}
			</div>
		</div>
	
		<div class="pdf-pages" id="pdf-page3">
			<div class="survey-overview survey-overview-pdf">
				<h1 class="page-main-heading">Sample Advanced Analysis from AskByPoll</h1>
				<p class="pdf-data">
					Use the Dashboard for more advanced real time analysis like –
				</p>
				<p class="pdf-data pdf-data-tabbed">
					•	Country & State Specific Location Breakdown – Click on the Country graph.<br>
					•	Choice specific analysis – Choose specific choice from dropdown<br>
					•	Multi-Variable Comparative Analysis - Choose multiple parameters from the dropdown based on the comparison to be done with the base graph. <br>
				</p>
				<p class="pdf-data	">
					A sample example of real time Multi-Variable Comparative Analysis – 
				</p>
				<p class="pdf-data pdf-data-bold">
					Base Graph vs. Multi Parameter Graph
				</p>
				{% for poll in polls %}
				{% if poll.question.id == maxVotedQuestion %}
					<div id="pollsChart-pdf-cmp1" class="pollsChartPDF"></div>
					<div id="advancedAna" class="advancedAnaPDF">
						<p style="margin-bottom:1rem;"> Filter by different parameters </p>
						<select class="advancedanalyseSelectPDF">
							<option value="nochoice">Gender</option>
						</select>
						<select class="advancedanalyseSelectPDF">
							<option value="26-30">26-30</option>
						</select>
						<select class="advancedanalyseSelectPDF">
							<option value="nochoice">Profession</option>
						</select>
						<select class="advancedanalyseSelectPDF">
							<option value="nochoice">India</option>
						</select>
						<select class="advancedanalyseSelectPDF">
							<option value="nochoice">State</option>
						</select>
					</div>
					<div id="pollsChart-pdf-cmp2" class="pollsChartPDF"></div>
					<p class="pdf-data pdf-data-bold">
						Base Pie Charts vs. Choice Specific Pie Charts:
					</p><br>
					<div class="analysis-pdf">
					<div class="analysis-pdf-cmp">
						<select class="advancedanalyseSelectPDF advancedanalyseSelectPDFAbsolute">
							<option value="nochoice">Filter by Choice</option>
						</select>
						<div class="pdf-chart" id="genderchart-cmp1"></div>
					</div>
					<div class="analysis-pdf-cmp">
						<select class="advancedanalyseSelectPDF advancedanalyseSelectPDFAbsolute">
							<option value="nochoice">{{ poll.maxVotedChoiceStr }}</option>
						</select>						
						<div class="pdf-chart" id="genderchart-cmp2"></div>
					</div>
					</div>
					<script type="text/javascript">
						google.setOnLoadCallback(drawPollsChartPDF({{ poll.choice_graph|safe }},"pollsChart-pdf-cmp1",{{ poll.total_choice_vote }}));
						google.setOnLoadCallback(drawPollsChartPDF({{ poll.choice_graph_filter|safe }},"pollsChart-pdf-cmp2",{{ poll.total_choice_vote_filter }}));
						google.setOnLoadCallback(drawGenderChartPDF({{ poll.gender_graph|safe }},"genderchart-cmp1"));
						google.setOnLoadCallback(drawGenderChartPDF({{ poll.gender_graph_filter|safe }},"genderchart-cmp2"));
					</script>
				{% endif %}
				{% endfor %}
			</div>
		</div>
	<script type="text/javascript">
		$(document).ready(function()
		{
			$('.choice_image').css({"width":"120px","height":"120px"});
		});
	</script>
{% endblock %}
